import{t as bt,e as lt}from"./tslib-297d41fd.js";import{H as Gt,M as Ko,G as Vo,E as kt}from"./chunk-55IO54NW-f7e1bd9c.js";import{e as qi,c as Bi,s as Ki,a as Vi,d as Gi,g as Go,h as ko,i as Jn,j as As,b as Wo,k as Yo,l as Xn,f as ki,m as Jo,J as Er,n as Wi,o as Yi,q as Pt,r as xt,t as Zn,u as Ji,H as Yr}from"./index-54fed4a6.js";import{P as ci}from"./index-8dfb0143.js";function Xo(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Zo=Qo;function Qo(t,e,r){var i=r&&r.stringify||Xo,s=1;if(typeof t=="object"&&t!==null){var c=e.length+s;if(c===1)return t;var p=new Array(c);p[0]=i(t);for(var h=1;h<c;h++)p[h]=i(e[h]);return p.join(" ")}if(typeof t!="string")return t;var f=e.length;if(f===0)return t;for(var _="",m=1-s,w=-1,N=t&&t.length||0,v=0;v<N;){if(t.charCodeAt(v)===37&&v+1<N){switch(w=w>-1?w:0,t.charCodeAt(v+1)){case 100:case 102:if(m>=f||e[m]==null)break;w<v&&(_+=t.slice(w,v)),_+=Number(e[m]),w=v+2,v++;break;case 105:if(m>=f||e[m]==null)break;w<v&&(_+=t.slice(w,v)),_+=Math.floor(Number(e[m])),w=v+2,v++;break;case 79:case 111:case 106:if(m>=f||e[m]===void 0)break;w<v&&(_+=t.slice(w,v));var D=typeof e[m];if(D==="string"){_+="'"+e[m]+"'",w=v+2,v++;break}if(D==="function"){_+=e[m].name||"<anonymous>",w=v+2,v++;break}_+=i(e[m]),w=v+2,v++;break;case 115:if(m>=f)break;w<v&&(_+=t.slice(w,v)),_+=String(e[m]),w=v+2,v++;break;case 37:w<v&&(_+=t.slice(w,v)),_+="%",w=v+2,v++,m--;break}++m}++v}return w===-1?t:(w<N&&(_+=t.slice(w)),_)}const Ns=Zo;var wr=vt;const br=hc().console||{},ec={mapHttpRequest:Lr,mapHttpResponse:Lr,wrapRequestSerializer:hi,wrapResponseSerializer:hi,wrapErrorSerializer:hi,req:Lr,res:Lr,err:nc};function tc(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function vt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||br;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=tc(t.browser.serialize,i);let c=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const p=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const h=t.level||"info",f=Object.create(r);f.log||(f.log=mr),Object.defineProperty(f,"levelVal",{get:m}),Object.defineProperty(f,"level",{get:w,set:N});const _={transmit:e,serialize:s,asObject:t.browser.asObject,levels:p,timestamp:ac(t)};f.levels=vt.levels,f.level=h,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=mr,f.serializers=i,f._serialize=s,f._stdErrSerialize=c,f.child=v,e&&(f._logEvent=Ai());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function w(){return this._level}function N(D){if(D!=="silent"&&!this.levels.values[D])throw Error("unknown level "+D);this._level=D,Jt(_,f,"error","log"),Jt(_,f,"fatal","error"),Jt(_,f,"warn","error"),Jt(_,f,"info","log"),Jt(_,f,"debug","log"),Jt(_,f,"trace","log")}function v(D,U){if(!D)throw new Error("missing bindings for child Pino");U=U||{},s&&D.serializers&&(U.serializers=D.serializers);const x=U.serializers;if(s&&x){var R=Object.assign({},i,x),o=t.browser.serialize===!0?Object.keys(R):s;delete D.serializers,Jr([D],o,R,this._stdErrSerialize)}function d(u){this._childLevel=(u._childLevel|0)+1,this.error=Xt(u,D,"error"),this.fatal=Xt(u,D,"fatal"),this.warn=Xt(u,D,"warn"),this.info=Xt(u,D,"info"),this.debug=Xt(u,D,"debug"),this.trace=Xt(u,D,"trace"),R&&(this.serializers=R,this._serialize=o),e&&(this._logEvent=Ai([].concat(u._logEvent.bindings,D)))}return d.prototype=this,new d(this)}return f}vt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};vt.stdSerializers=ec;vt.stdTimeFunctions=Object.assign({},{nullTime:Qn,epochTime:ea,unixTime:oc,isoTime:cc});function Jt(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?mr:s[r]?s[r]:br[r]||br[i]||mr,rc(t,e,r)}function rc(t,e,r){!t.transmit&&e[r]===mr||(e[r]=function(i){return function(){const c=t.timestamp(),p=new Array(arguments.length),h=Object.getPrototypeOf&&Object.getPrototypeOf(this)===br?br:this;for(var f=0;f<p.length;f++)p[f]=arguments[f];if(t.serialize&&!t.asObject&&Jr(p,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(h,ic(this,r,p,c)):i.apply(h,p),t.transmit){const _=t.transmit.level||e.level,m=vt.levels.values[_],w=vt.levels.values[r];if(w<m)return;sc(this,{ts:c,methodLevel:r,methodValue:w,transmitLevel:_,transmitValue:vt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},p)}}}(e[r]))}function ic(t,e,r,i){t._serialize&&Jr(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let c=s[0];const p={};i&&(p.time=i),p.level=vt.levels.values[e];let h=(t._childLevel|0)+1;if(h<1&&(h=1),c!==null&&typeof c=="object"){for(;h--&&typeof s[0]=="object";)Object.assign(p,s.shift());c=s.length?Ns(s.shift(),s):void 0}else typeof c=="string"&&(c=Ns(s.shift(),s));return c!==void 0&&(p.msg=c),p}function Jr(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=vt.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const c in t[s])e&&e.indexOf(c)>-1&&c in r&&(t[s][c]=r[c](t[s][c]))}function Xt(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function sc(t,e,r){const i=e.send,s=e.ts,c=e.methodLevel,p=e.methodValue,h=e.val,f=t._logEvent.bindings;Jr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(_){return f.indexOf(_)===-1}),t._logEvent.level.label=c,t._logEvent.level.value=p,i(c,t._logEvent,h),t._logEvent=Ai(f)}function Ai(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function nc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function ac(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Qn:ea}function Lr(){return{}}function hi(t){return t}function mr(){}function Qn(){return!1}function ea(){return Date.now()}function oc(){return Math.round(Date.now()/1e3)}function cc(){return new Date(Date.now()).toISOString()}function hc(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var Xr={},vr={};Object.defineProperty(vr,"__esModule",{value:!0});function uc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}vr.safeJsonParse=uc;function lc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}vr.safeJsonStringify=lc;var zr={},ui={get exports(){return zr},set exports(t){zr=t}},Ts;function fc(){return Ts||(Ts=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Gt<"u"&&Gt.localStorage?ui.exports=Gt.localStorage:typeof window<"u"&&window.localStorage?ui.exports=window.localStorage:ui.exports=new e}()),zr}var li={},or={},Cs;function dc(){if(Cs)return or;Cs=1,Object.defineProperty(or,"__esModule",{value:!0}),or.IKeyValueStorage=void 0;class t{}return or.IKeyValueStorage=t,or}var cr={},Ps;function gc(){if(Ps)return cr;Ps=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.parseEntry=void 0;const t=vr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return cr.parseEntry=e,cr}var Us;function pc(){return Us||(Us=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt;e.__exportStar(dc(),t),e.__exportStar(gc(),t)}(li)),li}Object.defineProperty(Xr,"__esModule",{value:!0});Xr.KeyValueStorage=void 0;const tr=bt,Rs=vr,yc=tr.__importDefault(fc()),bc=pc();class ta{constructor(){this.localStorage=yc.default}getKeys(){return tr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return tr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(bc.parseEntry)})}getItem(e){return tr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return Rs.safeJsonParse(r)})}setItem(e,r){return tr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Rs.safeJsonStringify(r))})}removeItem(e){return tr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Xr.KeyValueStorage=ta;var mc=Xr.default=ta,Dr={},hr={},J={},fi={},ur={},Fs;function _c(){if(Fs)return ur;Fs=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return ur.delay=t,ur}var zt={},di={},qt={},Ls;function Ec(){return Ls||(Ls=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.ONE_THOUSAND=qt.ONE_HUNDRED=void 0,qt.ONE_HUNDRED=100,qt.ONE_THOUSAND=1e3),qt}var gi={},Ms;function wc(){return Ms||(Ms=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(gi)),gi}var $s;function ra(){return $s||($s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt;e.__exportStar(Ec(),t),e.__exportStar(wc(),t)}(di)),di}var js;function vc(){if(js)return zt;js=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.fromMiliseconds=zt.toMiliseconds=void 0;const t=ra();function e(i){return i*t.ONE_THOUSAND}zt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return zt.fromMiliseconds=r,zt}var Hs;function Dc(){return Hs||(Hs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt;e.__exportStar(_c(),t),e.__exportStar(vc(),t)}(fi)),fi}var Zt={},zs;function Sc(){if(zs)return Zt;zs=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Zt.Watch=t,Zt.default=t,Zt}var pi={},lr={},qs;function Ic(){if(qs)return lr;qs=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.IWatch=void 0;class t{}return lr.IWatch=t,lr}var Bs;function xc(){return Bs||(Bs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),bt.__exportStar(Ic(),t)}(pi)),pi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt;e.__exportStar(Dc(),t),e.__exportStar(Sc(),t),e.__exportStar(xc(),t),e.__exportStar(ra(),t)})(J);var yi={},fr={};class Wt{}const Oc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Wt},Symbol.toStringTag,{value:"Module"})),Ac=Ko(Oc);var Ks;function Nc(){if(Ks)return fr;Ks=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.IHeartBeat=void 0;const t=Ac;class e extends t.IEvents{constructor(i){super()}}return fr.IHeartBeat=e,fr}var Vs;function ia(){return Vs||(Vs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),bt.__exportStar(Nc(),t)}(yi)),yi}var bi={},Bt={},Gs;function Tc(){if(Gs)return Bt;Gs=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.HEARTBEAT_EVENTS=Bt.HEARTBEAT_INTERVAL=void 0;const t=J;return Bt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Bt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Bt}var ks;function sa(){return ks||(ks=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),bt.__exportStar(Tc(),t)}(bi)),bi}var Ws;function Cc(){if(Ws)return hr;Ws=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.HeartBeat=void 0;const t=bt,e=lt,r=J,i=ia(),s=sa();class c extends i.IHeartBeat{constructor(h){super(h),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(h==null?void 0:h.interval)||s.HEARTBEAT_INTERVAL}static init(h){return t.__awaiter(this,void 0,void 0,function*(){const f=new c(h);return yield f.init(),f})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(h,f){this.events.on(h,f)}once(h,f){this.events.once(h,f)}off(h,f){this.events.off(h,f)}removeListener(h,f){this.events.removeListener(h,f)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return hr.HeartBeat=c,hr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt;e.__exportStar(Cc(),t),e.__exportStar(ia(),t),e.__exportStar(sa(),t)})(Dr);var Se={},Kt={},Ys;function na(){return Ys||(Ys=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PINO_CUSTOM_CONTEXT_KEY=Kt.PINO_LOGGER_DEFAULTS=void 0,Kt.PINO_LOGGER_DEFAULTS={level:"info"},Kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Kt}var tt={},Js;function Pc(){if(Js)return tt;Js=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.generateChildLogger=tt.formatChildLoggerContext=tt.getLoggerContext=tt.setBrowserLoggerContext=tt.getBrowserLoggerContext=tt.getDefaultLoggerOptions=void 0;const t=na();function e(h){return Object.assign(Object.assign({},h),{level:(h==null?void 0:h.level)||t.PINO_LOGGER_DEFAULTS.level})}tt.getDefaultLoggerOptions=e;function r(h,f=t.PINO_CUSTOM_CONTEXT_KEY){return h[f]||""}tt.getBrowserLoggerContext=r;function i(h,f,_=t.PINO_CUSTOM_CONTEXT_KEY){return h[_]=f,h}tt.setBrowserLoggerContext=i;function s(h,f=t.PINO_CUSTOM_CONTEXT_KEY){let _="";return typeof h.bindings>"u"?_=r(h,f):_=h.bindings().context||"",_}tt.getLoggerContext=s;function c(h,f,_=t.PINO_CUSTOM_CONTEXT_KEY){const m=s(h,_);return m.trim()?`${m}/${f}`:f}tt.formatChildLoggerContext=c;function p(h,f,_=t.PINO_CUSTOM_CONTEXT_KEY){const m=c(h,f,_),w=h.child({context:m});return i(w,m,_)}return tt.generateChildLogger=p,tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=bt,r=e.__importDefault(wr);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(na(),t),e.__exportStar(Pc(),t)})(Se);class Uc extends Wt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Rc=class extends Wt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},Fc=class{constructor(e,r){this.logger=e,this.core=r}},Lc=class extends Wt{constructor(e,r){super(),this.relayer=e,this.logger=r}};class Mc extends Wt{constructor(e){super()}}let $c=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}};class jc extends Wt{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Hc=class extends Wt{constructor(e,r){super(),this.core=e,this.logger=r}};var Xi={},rr={},Zr={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.BrowserRandomSource=void 0;const Xs=65536;class zc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Xs)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Xs)));return r}}Qr.BrowserRandomSource=zc;function qc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ei={},ot={};Object.defineProperty(ot,"__esModule",{value:!0});function Bc(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ot.wipe=Bc;Object.defineProperty(ei,"__esModule",{value:!0});ei.NodeRandomSource=void 0;const Kc=ot;class Vc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof qc<"u"){const e=Vo;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,Kc.wipe)(r),i}}ei.NodeRandomSource=Vc;Object.defineProperty(Zr,"__esModule",{value:!0});Zr.SystemRandomSource=void 0;const Gc=Qr,kc=ei;class Wc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Gc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new kc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Zr.SystemRandomSource=Wc;var re={},aa={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(h,f){var _=h>>>16&65535,m=h&65535,w=f>>>16&65535,N=f&65535;return m*N+(_*N+m*w<<16>>>0)|0}t.mul=Math.imul||e;function r(h,f){return h+f|0}t.add=r;function i(h,f){return h-f|0}t.sub=i;function s(h,f){return h<<f|h>>>32-f}t.rotl=s;function c(h,f){return h<<32-f|h>>>f}t.rotr=c;function p(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h}t.isInteger=Number.isInteger||p,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(h){return t.isInteger(h)&&h>=-t.MAX_SAFE_INTEGER&&h<=t.MAX_SAFE_INTEGER}})(aa);Object.defineProperty(re,"__esModule",{value:!0});var oa=aa;function Yc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=Yc;function Jc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=Jc;function Xc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=Xc;function Zc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=Zc;function ca(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=ca;re.writeInt16BE=ca;function ha(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=ha;re.writeInt16LE=ha;function Ni(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=Ni;function Ti(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=Ti;function Ci(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=Ci;function Pi(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=Pi;function qr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=qr;re.writeInt32BE=qr;function Br(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=Br;re.writeInt32LE=Br;function Qc(t,e){e===void 0&&(e=0);var r=Ni(t,e),i=Ni(t,e+4);return r*4294967296+i-(i>>31)*4294967296}re.readInt64BE=Qc;function eh(t,e){e===void 0&&(e=0);var r=Ti(t,e),i=Ti(t,e+4);return r*4294967296+i}re.readUint64BE=eh;function th(t,e){e===void 0&&(e=0);var r=Ci(t,e),i=Ci(t,e+4);return i*4294967296+r-(r>>31)*4294967296}re.readInt64LE=th;function rh(t,e){e===void 0&&(e=0);var r=Pi(t,e),i=Pi(t,e+4);return i*4294967296+r}re.readUint64LE=rh;function ua(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),qr(t/4294967296>>>0,e,r),qr(t>>>0,e,r+4),e}re.writeUint64BE=ua;re.writeInt64BE=ua;function la(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Br(t>>>0,e,r),Br(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=la;re.writeInt64LE=la;function ih(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,c=t/8+r-1;c>=r;c--)i+=e[c]*s,s*=256;return i}re.readUintBE=ih;function sh(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,c=r;c<r+t/8;c++)i+=e[c]*s,s*=256;return i}re.readUintLE=sh;function nh(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!oa.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,c=t/8+i-1;c>=i;c--)r[c]=e/s&255,s*=256;return r}re.writeUintBE=nh;function ah(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!oa.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,c=i;c<i+t/8;c++)r[c]=e/s&255,s*=256;return r}re.writeUintLE=ah;function oh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=oh;function ch(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=ch;function hh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=hh;function uh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=uh;function lh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}re.writeFloat32BE=lh;function fh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}re.writeFloat32LE=fh;function dh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}re.writeFloat64BE=dh;function gh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}re.writeFloat64LE=gh;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Zr,r=re,i=ot;t.defaultRandomSource=new e.SystemRandomSource;function s(_,m=t.defaultRandomSource){return m.randomBytes(_)}t.randomBytes=s;function c(_=t.defaultRandomSource){const m=s(4,_),w=(0,r.readUint32LE)(m);return(0,i.wipe)(m),w}t.randomUint32=c;const p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function h(_,m=p,w=t.defaultRandomSource){if(m.length<2)throw new Error("randomString charset is too short");if(m.length>256)throw new Error("randomString charset is too long");let N="";const v=m.length,D=256-256%v;for(;_>0;){const U=s(Math.ceil(_*256/D),w);for(let x=0;x<U.length&&_>0;x++){const R=U[x];R<D&&(N+=m.charAt(R%v),_--)}(0,i.wipe)(U)}return N}t.randomString=h;function f(_,m=p,w=t.defaultRandomSource){const N=Math.ceil(_/(Math.log(m.length)/Math.LN2));return h(N,m,w)}t.randomStringForEntropy=f})(rr);var fa={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ot;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function h(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},h.prototype.update=function(f,_){if(_===void 0&&(_=f.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var m=0;if(this._bytesHashed+=_,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&_>0;)this._buffer[this._bufferLength++]=f[m++],_--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(_>=this.blockSize&&(m=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,f,m,_),_%=this.blockSize);_>0;)this._buffer[this._bufferLength++]=f[m++],_--;return this},h.prototype.finish=function(f){if(!this._finished){var _=this._bytesHashed,m=this._bufferLength,w=_/536870912|0,N=_<<3,v=_%128<112?128:256;this._buffer[m]=128;for(var D=m+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(w,this._buffer,v-8),e.writeUint32BE(N,this._buffer,v-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)e.writeUint32BE(this._stateHi[D],f,D*8),e.writeUint32BE(this._stateLo[D],f,D*8+4);return this},h.prototype.digest=function(){var f=new Uint8Array(this.digestLength);return this.finish(f),f},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(f){return this._stateHi.set(f.stateHi),this._stateLo.set(f.stateLo),this._bufferLength=f.bufferLength,f.buffer&&this._buffer.set(f.buffer),this._bytesHashed=f.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(f){r.wipe(f.stateHi),r.wipe(f.stateLo),f.buffer&&r.wipe(f.buffer),f.bufferLength=0,f.bytesHashed=0},h}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(h,f,_,m,w,N,v){for(var D=_[0],U=_[1],x=_[2],R=_[3],o=_[4],d=_[5],u=_[6],l=_[7],y=m[0],n=m[1],g=m[2],P=m[3],j=m[4],W=m[5],Y=m[6],X=m[7],C,T,G,H,L,M,$,z;v>=128;){for(var ie=0;ie<16;ie++){var q=8*ie+N;h[ie]=e.readUint32BE(w,q),f[ie]=e.readUint32BE(w,q+4)}for(var ie=0;ie<80;ie++){var Z=D,k=U,oe=x,A=R,O=o,S=d,a=u,E=l,B=y,K=n,le=g,be=P,de=j,Ee=W,Ue=Y,Ne=X;if(C=l,T=X,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=(o>>>14|j<<32-14)^(o>>>18|j<<32-18)^(j>>>41-32|o<<32-(41-32)),T=(j>>>14|o<<32-14)^(j>>>18|o<<32-18)^(o>>>41-32|j<<32-(41-32)),L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,C=o&d^~o&u,T=j&W^~j&Y,L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,C=s[ie*2],T=s[ie*2+1],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,C=h[ie%16],T=f[ie%16],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,G=$&65535|z<<16,H=L&65535|M<<16,C=G,T=H,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=(D>>>28|y<<32-28)^(y>>>34-32|D<<32-(34-32))^(y>>>39-32|D<<32-(39-32)),T=(y>>>28|D<<32-28)^(D>>>34-32|y<<32-(34-32))^(D>>>39-32|y<<32-(39-32)),L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,C=D&U^D&x^U&x,T=y&n^y&g^n&g,L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,E=$&65535|z<<16,Ne=L&65535|M<<16,C=A,T=be,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=G,T=H,L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,A=$&65535|z<<16,be=L&65535|M<<16,U=Z,x=k,R=oe,o=A,d=O,u=S,l=a,D=E,n=B,g=K,P=le,j=be,W=de,Y=Ee,X=Ue,y=Ne,ie%16===15)for(var q=0;q<16;q++)C=h[q],T=f[q],L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=h[(q+9)%16],T=f[(q+9)%16],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,G=h[(q+1)%16],H=f[(q+1)%16],C=(G>>>1|H<<32-1)^(G>>>8|H<<32-8)^G>>>7,T=(H>>>1|G<<32-1)^(H>>>8|G<<32-8)^(H>>>7|G<<32-7),L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,G=h[(q+14)%16],H=f[(q+14)%16],C=(G>>>19|H<<32-19)^(H>>>61-32|G<<32-(61-32))^G>>>6,T=(H>>>19|G<<32-19)^(G>>>61-32|H<<32-(61-32))^(H>>>6|G<<32-6),L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,h[q]=$&65535|z<<16,f[q]=L&65535|M<<16}C=D,T=y,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[0],T=m[0],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[0]=D=$&65535|z<<16,m[0]=y=L&65535|M<<16,C=U,T=n,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[1],T=m[1],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[1]=U=$&65535|z<<16,m[1]=n=L&65535|M<<16,C=x,T=g,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[2],T=m[2],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[2]=x=$&65535|z<<16,m[2]=g=L&65535|M<<16,C=R,T=P,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[3],T=m[3],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[3]=R=$&65535|z<<16,m[3]=P=L&65535|M<<16,C=o,T=j,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[4],T=m[4],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[4]=o=$&65535|z<<16,m[4]=j=L&65535|M<<16,C=d,T=W,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[5],T=m[5],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[5]=d=$&65535|z<<16,m[5]=W=L&65535|M<<16,C=u,T=Y,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[6],T=m[6],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[6]=u=$&65535|z<<16,m[6]=Y=L&65535|M<<16,C=l,T=X,L=T&65535,M=T>>>16,$=C&65535,z=C>>>16,C=_[7],T=m[7],L+=T&65535,M+=T>>>16,$+=C&65535,z+=C>>>16,M+=L>>>16,$+=M>>>16,z+=$>>>16,_[7]=l=$&65535|z<<16,m[7]=X=L&65535|M<<16,N+=128,v-=128}return N}function p(h){var f=new i;f.update(h);var _=f.digest();return f.clean(),_}t.hash=p})(fa);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=rr,r=fa,i=ot;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(A){const O=new Float64Array(16);if(A)for(let S=0;S<A.length;S++)O[S]=A[S];return O}const c=new Uint8Array(32);c[0]=9;const p=s(),h=s([1]),f=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),_=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),m=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),w=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(A,O){for(let S=0;S<16;S++)A[S]=O[S]|0}function D(A){let O=1;for(let S=0;S<16;S++){let a=A[S]+O+65535;O=Math.floor(a/65536),A[S]=a-O*65536}A[0]+=O-1+37*(O-1)}function U(A,O,S){const a=~(S-1);for(let E=0;E<16;E++){const B=a&(A[E]^O[E]);A[E]^=B,O[E]^=B}}function x(A,O){const S=s(),a=s();for(let E=0;E<16;E++)a[E]=O[E];D(a),D(a),D(a);for(let E=0;E<2;E++){S[0]=a[0]-65517;for(let K=1;K<15;K++)S[K]=a[K]-65535-(S[K-1]>>16&1),S[K-1]&=65535;S[15]=a[15]-32767-(S[14]>>16&1);const B=S[15]>>16&1;S[14]&=65535,U(a,S,1-B)}for(let E=0;E<16;E++)A[2*E]=a[E]&255,A[2*E+1]=a[E]>>8}function R(A,O){let S=0;for(let a=0;a<32;a++)S|=A[a]^O[a];return(1&S-1>>>8)-1}function o(A,O){const S=new Uint8Array(32),a=new Uint8Array(32);return x(S,A),x(a,O),R(S,a)}function d(A){const O=new Uint8Array(32);return x(O,A),O[0]&1}function u(A,O){for(let S=0;S<16;S++)A[S]=O[2*S]+(O[2*S+1]<<8);A[15]&=32767}function l(A,O,S){for(let a=0;a<16;a++)A[a]=O[a]+S[a]}function y(A,O,S){for(let a=0;a<16;a++)A[a]=O[a]-S[a]}function n(A,O,S){let a,E,B=0,K=0,le=0,be=0,de=0,Ee=0,Ue=0,Ne=0,ye=0,ge=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,pe=0,te=0,me=0,_e=0,ve=0,De=0,we=0,ft=0,mt=0,At=0,st=0,Mt=0,sr=0,Nr=0,Re=S[0],Te=S[1],Fe=S[2],Le=S[3],Me=S[4],Ce=S[5],He=S[6],ze=S[7],qe=S[8],Be=S[9],Ke=S[10],je=S[11],$e=S[12],Oe=S[13],Ve=S[14],Ge=S[15];a=O[0],B+=a*Re,K+=a*Te,le+=a*Fe,be+=a*Le,de+=a*Me,Ee+=a*Ce,Ue+=a*He,Ne+=a*ze,ye+=a*qe,ge+=a*Be,fe+=a*Ke,he+=a*je,ce+=a*$e,ae+=a*Oe,ne+=a*Ve,ee+=a*Ge,a=O[1],K+=a*Re,le+=a*Te,be+=a*Fe,de+=a*Le,Ee+=a*Me,Ue+=a*Ce,Ne+=a*He,ye+=a*ze,ge+=a*qe,fe+=a*Be,he+=a*Ke,ce+=a*je,ae+=a*$e,ne+=a*Oe,ee+=a*Ve,ue+=a*Ge,a=O[2],le+=a*Re,be+=a*Te,de+=a*Fe,Ee+=a*Le,Ue+=a*Me,Ne+=a*Ce,ye+=a*He,ge+=a*ze,fe+=a*qe,he+=a*Be,ce+=a*Ke,ae+=a*je,ne+=a*$e,ee+=a*Oe,ue+=a*Ve,pe+=a*Ge,a=O[3],be+=a*Re,de+=a*Te,Ee+=a*Fe,Ue+=a*Le,Ne+=a*Me,ye+=a*Ce,ge+=a*He,fe+=a*ze,he+=a*qe,ce+=a*Be,ae+=a*Ke,ne+=a*je,ee+=a*$e,ue+=a*Oe,pe+=a*Ve,te+=a*Ge,a=O[4],de+=a*Re,Ee+=a*Te,Ue+=a*Fe,Ne+=a*Le,ye+=a*Me,ge+=a*Ce,fe+=a*He,he+=a*ze,ce+=a*qe,ae+=a*Be,ne+=a*Ke,ee+=a*je,ue+=a*$e,pe+=a*Oe,te+=a*Ve,me+=a*Ge,a=O[5],Ee+=a*Re,Ue+=a*Te,Ne+=a*Fe,ye+=a*Le,ge+=a*Me,fe+=a*Ce,he+=a*He,ce+=a*ze,ae+=a*qe,ne+=a*Be,ee+=a*Ke,ue+=a*je,pe+=a*$e,te+=a*Oe,me+=a*Ve,_e+=a*Ge,a=O[6],Ue+=a*Re,Ne+=a*Te,ye+=a*Fe,ge+=a*Le,fe+=a*Me,he+=a*Ce,ce+=a*He,ae+=a*ze,ne+=a*qe,ee+=a*Be,ue+=a*Ke,pe+=a*je,te+=a*$e,me+=a*Oe,_e+=a*Ve,ve+=a*Ge,a=O[7],Ne+=a*Re,ye+=a*Te,ge+=a*Fe,fe+=a*Le,he+=a*Me,ce+=a*Ce,ae+=a*He,ne+=a*ze,ee+=a*qe,ue+=a*Be,pe+=a*Ke,te+=a*je,me+=a*$e,_e+=a*Oe,ve+=a*Ve,De+=a*Ge,a=O[8],ye+=a*Re,ge+=a*Te,fe+=a*Fe,he+=a*Le,ce+=a*Me,ae+=a*Ce,ne+=a*He,ee+=a*ze,ue+=a*qe,pe+=a*Be,te+=a*Ke,me+=a*je,_e+=a*$e,ve+=a*Oe,De+=a*Ve,we+=a*Ge,a=O[9],ge+=a*Re,fe+=a*Te,he+=a*Fe,ce+=a*Le,ae+=a*Me,ne+=a*Ce,ee+=a*He,ue+=a*ze,pe+=a*qe,te+=a*Be,me+=a*Ke,_e+=a*je,ve+=a*$e,De+=a*Oe,we+=a*Ve,ft+=a*Ge,a=O[10],fe+=a*Re,he+=a*Te,ce+=a*Fe,ae+=a*Le,ne+=a*Me,ee+=a*Ce,ue+=a*He,pe+=a*ze,te+=a*qe,me+=a*Be,_e+=a*Ke,ve+=a*je,De+=a*$e,we+=a*Oe,ft+=a*Ve,mt+=a*Ge,a=O[11],he+=a*Re,ce+=a*Te,ae+=a*Fe,ne+=a*Le,ee+=a*Me,ue+=a*Ce,pe+=a*He,te+=a*ze,me+=a*qe,_e+=a*Be,ve+=a*Ke,De+=a*je,we+=a*$e,ft+=a*Oe,mt+=a*Ve,At+=a*Ge,a=O[12],ce+=a*Re,ae+=a*Te,ne+=a*Fe,ee+=a*Le,ue+=a*Me,pe+=a*Ce,te+=a*He,me+=a*ze,_e+=a*qe,ve+=a*Be,De+=a*Ke,we+=a*je,ft+=a*$e,mt+=a*Oe,At+=a*Ve,st+=a*Ge,a=O[13],ae+=a*Re,ne+=a*Te,ee+=a*Fe,ue+=a*Le,pe+=a*Me,te+=a*Ce,me+=a*He,_e+=a*ze,ve+=a*qe,De+=a*Be,we+=a*Ke,ft+=a*je,mt+=a*$e,At+=a*Oe,st+=a*Ve,Mt+=a*Ge,a=O[14],ne+=a*Re,ee+=a*Te,ue+=a*Fe,pe+=a*Le,te+=a*Me,me+=a*Ce,_e+=a*He,ve+=a*ze,De+=a*qe,we+=a*Be,ft+=a*Ke,mt+=a*je,At+=a*$e,st+=a*Oe,Mt+=a*Ve,sr+=a*Ge,a=O[15],ee+=a*Re,ue+=a*Te,pe+=a*Fe,te+=a*Le,me+=a*Me,_e+=a*Ce,ve+=a*He,De+=a*ze,we+=a*qe,ft+=a*Be,mt+=a*Ke,At+=a*je,st+=a*$e,Mt+=a*Oe,sr+=a*Ve,Nr+=a*Ge,B+=38*ue,K+=38*pe,le+=38*te,be+=38*me,de+=38*_e,Ee+=38*ve,Ue+=38*De,Ne+=38*we,ye+=38*ft,ge+=38*mt,fe+=38*At,he+=38*st,ce+=38*Mt,ae+=38*sr,ne+=38*Nr,E=1,a=B+E+65535,E=Math.floor(a/65536),B=a-E*65536,a=K+E+65535,E=Math.floor(a/65536),K=a-E*65536,a=le+E+65535,E=Math.floor(a/65536),le=a-E*65536,a=be+E+65535,E=Math.floor(a/65536),be=a-E*65536,a=de+E+65535,E=Math.floor(a/65536),de=a-E*65536,a=Ee+E+65535,E=Math.floor(a/65536),Ee=a-E*65536,a=Ue+E+65535,E=Math.floor(a/65536),Ue=a-E*65536,a=Ne+E+65535,E=Math.floor(a/65536),Ne=a-E*65536,a=ye+E+65535,E=Math.floor(a/65536),ye=a-E*65536,a=ge+E+65535,E=Math.floor(a/65536),ge=a-E*65536,a=fe+E+65535,E=Math.floor(a/65536),fe=a-E*65536,a=he+E+65535,E=Math.floor(a/65536),he=a-E*65536,a=ce+E+65535,E=Math.floor(a/65536),ce=a-E*65536,a=ae+E+65535,E=Math.floor(a/65536),ae=a-E*65536,a=ne+E+65535,E=Math.floor(a/65536),ne=a-E*65536,a=ee+E+65535,E=Math.floor(a/65536),ee=a-E*65536,B+=E-1+37*(E-1),E=1,a=B+E+65535,E=Math.floor(a/65536),B=a-E*65536,a=K+E+65535,E=Math.floor(a/65536),K=a-E*65536,a=le+E+65535,E=Math.floor(a/65536),le=a-E*65536,a=be+E+65535,E=Math.floor(a/65536),be=a-E*65536,a=de+E+65535,E=Math.floor(a/65536),de=a-E*65536,a=Ee+E+65535,E=Math.floor(a/65536),Ee=a-E*65536,a=Ue+E+65535,E=Math.floor(a/65536),Ue=a-E*65536,a=Ne+E+65535,E=Math.floor(a/65536),Ne=a-E*65536,a=ye+E+65535,E=Math.floor(a/65536),ye=a-E*65536,a=ge+E+65535,E=Math.floor(a/65536),ge=a-E*65536,a=fe+E+65535,E=Math.floor(a/65536),fe=a-E*65536,a=he+E+65535,E=Math.floor(a/65536),he=a-E*65536,a=ce+E+65535,E=Math.floor(a/65536),ce=a-E*65536,a=ae+E+65535,E=Math.floor(a/65536),ae=a-E*65536,a=ne+E+65535,E=Math.floor(a/65536),ne=a-E*65536,a=ee+E+65535,E=Math.floor(a/65536),ee=a-E*65536,B+=E-1+37*(E-1),A[0]=B,A[1]=K,A[2]=le,A[3]=be,A[4]=de,A[5]=Ee,A[6]=Ue,A[7]=Ne,A[8]=ye,A[9]=ge,A[10]=fe,A[11]=he,A[12]=ce,A[13]=ae,A[14]=ne,A[15]=ee}function g(A,O){n(A,O,O)}function P(A,O){const S=s();let a;for(a=0;a<16;a++)S[a]=O[a];for(a=253;a>=0;a--)g(S,S),a!==2&&a!==4&&n(S,S,O);for(a=0;a<16;a++)A[a]=S[a]}function j(A,O){const S=s();let a;for(a=0;a<16;a++)S[a]=O[a];for(a=250;a>=0;a--)g(S,S),a!==1&&n(S,S,O);for(a=0;a<16;a++)A[a]=S[a]}function W(A,O){const S=s(),a=s(),E=s(),B=s(),K=s(),le=s(),be=s(),de=s(),Ee=s();y(S,A[1],A[0]),y(Ee,O[1],O[0]),n(S,S,Ee),l(a,A[0],A[1]),l(Ee,O[0],O[1]),n(a,a,Ee),n(E,A[3],O[3]),n(E,E,_),n(B,A[2],O[2]),l(B,B,B),y(K,a,S),y(le,B,E),l(be,B,E),l(de,a,S),n(A[0],K,le),n(A[1],de,be),n(A[2],be,le),n(A[3],K,de)}function Y(A,O,S){for(let a=0;a<4;a++)U(A[a],O[a],S)}function X(A,O){const S=s(),a=s(),E=s();P(E,O[2]),n(S,O[0],E),n(a,O[1],E),x(A,a),A[31]^=d(S)<<7}function C(A,O,S){v(A[0],p),v(A[1],h),v(A[2],h),v(A[3],p);for(let a=255;a>=0;--a){const E=S[a/8|0]>>(a&7)&1;Y(A,O,E),W(O,A),W(A,A),Y(A,O,E)}}function T(A,O){const S=[s(),s(),s(),s()];v(S[0],m),v(S[1],w),v(S[2],h),n(S[3],m,w),C(A,S,O)}function G(A){if(A.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const O=(0,r.hash)(A);O[0]&=248,O[31]&=127,O[31]|=64;const S=new Uint8Array(32),a=[s(),s(),s(),s()];T(a,O),X(S,a);const E=new Uint8Array(64);return E.set(A),E.set(S,32),{publicKey:S,secretKey:E}}t.generateKeyPairFromSeed=G;function H(A){const O=(0,e.randomBytes)(32,A),S=G(O);return(0,i.wipe)(O),S}t.generateKeyPair=H;function L(A){if(A.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(A.subarray(32))}t.extractPublicKeyFromSecretKey=L;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(A,O){let S,a,E,B;for(a=63;a>=32;--a){for(S=0,E=a-32,B=a-12;E<B;++E)O[E]+=S-16*O[a]*M[E-(a-32)],S=Math.floor((O[E]+128)/256),O[E]-=S*256;O[E]+=S,O[a]=0}for(S=0,E=0;E<32;E++)O[E]+=S-(O[31]>>4)*M[E],S=O[E]>>8,O[E]&=255;for(E=0;E<32;E++)O[E]-=S*M[E];for(a=0;a<32;a++)O[a+1]+=O[a]>>8,A[a]=O[a]&255}function z(A){const O=new Float64Array(64);for(let S=0;S<64;S++)O[S]=A[S];for(let S=0;S<64;S++)A[S]=0;$(A,O)}function ie(A,O){const S=new Float64Array(64),a=[s(),s(),s(),s()],E=(0,r.hash)(A.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const B=new Uint8Array(64);B.set(E.subarray(32),32);const K=new r.SHA512;K.update(B.subarray(32)),K.update(O);const le=K.digest();K.clean(),z(le),T(a,le),X(B,a),K.reset(),K.update(B.subarray(0,32)),K.update(A.subarray(32)),K.update(O);const be=K.digest();z(be);for(let de=0;de<32;de++)S[de]=le[de];for(let de=0;de<32;de++)for(let Ee=0;Ee<32;Ee++)S[de+Ee]+=be[de]*E[Ee];return $(B.subarray(32),S),B}t.sign=ie;function q(A,O){const S=s(),a=s(),E=s(),B=s(),K=s(),le=s(),be=s();return v(A[2],h),u(A[1],O),g(E,A[1]),n(B,E,f),y(E,E,A[2]),l(B,A[2],B),g(K,B),g(le,K),n(be,le,K),n(S,be,E),n(S,S,B),j(S,S),n(S,S,E),n(S,S,B),n(S,S,B),n(A[0],S,B),g(a,A[0]),n(a,a,B),o(a,E)&&n(A[0],A[0],N),g(a,A[0]),n(a,a,B),o(a,E)?-1:(d(A[0])===O[31]>>7&&y(A[0],p,A[0]),n(A[3],A[0],A[1]),0)}function Z(A,O,S){const a=new Uint8Array(32),E=[s(),s(),s(),s()],B=[s(),s(),s(),s()];if(S.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(q(B,A))return!1;const K=new r.SHA512;K.update(S.subarray(0,32)),K.update(A),K.update(O);const le=K.digest();return z(le),C(E,B,le),T(B,S.subarray(32)),W(E,B),X(a,E),!R(S,a)}t.verify=Z;function k(A){let O=[s(),s(),s(),s()];if(q(O,A))throw new Error("Ed25519: invalid public key");let S=s(),a=s(),E=O[1];l(S,h,E),y(a,h,E),P(a,a),n(S,S,a);let B=new Uint8Array(32);return x(B,S),B}t.convertPublicKeyToX25519=k;function oe(A){const O=(0,r.hash)(A.subarray(0,32));O[0]&=248,O[31]&=127,O[31]|=64;const S=new Uint8Array(O.subarray(0,32));return(0,i.wipe)(O),S}t.convertSecretKeyToX25519=oe})(Xi);const ph="EdDSA",yh="JWT",da=".",ga="base64url",bh="utf8",mh="utf8",_h=":",Eh="did",wh="key",Zs="base58btc",vh="z",Dh="K36",Sh=32;function Zi(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function pa(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Zi(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ih(t,e){e||(e=t.reduce((s,c)=>s+c.length,0));const r=pa(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Zi(r)}function xh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=s}var h=t.length,f=t.charAt(0),_=Math.log(h)/Math.log(256),m=Math.log(256)/Math.log(h);function w(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var U=0,x=0,R=0,o=D.length;R!==o&&D[R]===0;)R++,U++;for(var d=(o-R)*m+1>>>0,u=new Uint8Array(d);R!==o;){for(var l=D[R],y=0,n=d-1;(l!==0||y<x)&&n!==-1;n--,y++)l+=256*u[n]>>>0,u[n]=l%h>>>0,l=l/h>>>0;if(l!==0)throw new Error("Non-zero carry");x=y,R++}for(var g=d-x;g!==d&&u[g]===0;)g++;for(var P=f.repeat(U);g<d;++g)P+=t.charAt(u[g]);return P}function N(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var U=0;if(D[U]!==" "){for(var x=0,R=0;D[U]===f;)x++,U++;for(var o=(D.length-U)*_+1>>>0,d=new Uint8Array(o);D[U];){var u=r[D.charCodeAt(U)];if(u===255)return;for(var l=0,y=o-1;(u!==0||l<R)&&y!==-1;y--,l++)u+=h*d[y]>>>0,d[y]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");R=l,U++}if(D[U]!==" "){for(var n=o-R;n!==o&&d[n]===0;)n++;for(var g=new Uint8Array(x+(o-n)),P=x;n!==o;)g[P++]=d[n++];return g}}}function v(D){var U=N(D);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:w,decodeUnsafe:N,decode:v}}var Oh=xh,Ah=Oh;const Nh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Th=t=>new TextEncoder().encode(t),Ch=t=>new TextDecoder().decode(t);class Ph{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Uh{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ya(this,e)}}class Rh{constructor(e){this.decoders=e}or(e){return ya(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ya=(t,e)=>new Rh({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Fh{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Ph(e,r,i),this.decoder=new Uh(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:i})=>new Fh(t,e,r,i),Sr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Ah(r,e);return ti({prefix:t,name:e,encode:i,decode:c=>Nh(s(c))})},Lh=(t,e,r,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let h=0,f=0,_=0;for(let m=0;m<c;++m){const w=s[t[m]];if(w===void 0)throw new SyntaxError(`Non-${i} character`);f=f<<r|w,h+=r,h>=8&&(h-=8,p[_++]=255&f>>h)}if(h>=r||255&f<<8-h)throw new SyntaxError("Unexpected end of data");return p},Mh=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",p=0,h=0;for(let f=0;f<t.length;++f)for(h=h<<8|t[f],p+=8;p>r;)p-=r,c+=e[s&h>>p];if(p&&(c+=e[s&h<<r-p]),i)for(;c.length*r&7;)c+="=";return c},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ti({prefix:e,name:t,encode(s){return Mh(s,i,r)},decode(s){return Lh(s,i,r,t)}}),$h=ti({prefix:"\0",name:"identity",encode:t=>Ch(t),decode:t=>Th(t)}),jh=Object.freeze(Object.defineProperty({__proto__:null,identity:$h},Symbol.toStringTag,{value:"Module"})),Hh=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),zh=Object.freeze(Object.defineProperty({__proto__:null,base2:Hh},Symbol.toStringTag,{value:"Module"})),qh=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Bh=Object.freeze(Object.defineProperty({__proto__:null,base8:qh},Symbol.toStringTag,{value:"Module"})),Kh=Sr({prefix:"9",name:"base10",alphabet:"0123456789"}),Vh=Object.freeze(Object.defineProperty({__proto__:null,base10:Kh},Symbol.toStringTag,{value:"Module"})),Gh=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kh=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Wh=Object.freeze(Object.defineProperty({__proto__:null,base16:Gh,base16upper:kh},Symbol.toStringTag,{value:"Module"})),Yh=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Jh=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xh=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zh=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Qh=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eu=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),tu=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ru=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),iu=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),su=Object.freeze(Object.defineProperty({__proto__:null,base32:Yh,base32hex:Qh,base32hexpad:tu,base32hexpadupper:ru,base32hexupper:eu,base32pad:Xh,base32padupper:Zh,base32upper:Jh,base32z:iu},Symbol.toStringTag,{value:"Module"})),nu=Sr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),au=Sr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ou=Object.freeze(Object.defineProperty({__proto__:null,base36:nu,base36upper:au},Symbol.toStringTag,{value:"Module"})),cu=Sr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hu=Sr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),uu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:cu,base58flickr:hu},Symbol.toStringTag,{value:"Module"})),lu=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),fu=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),du=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gu=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),pu=Object.freeze(Object.defineProperty({__proto__:null,base64:lu,base64pad:fu,base64url:du,base64urlpad:gu},Symbol.toStringTag,{value:"Module"})),ba=Array.from(""),yu=ba.reduce((t,e,r)=>(t[r]=e,t),[]),bu=ba.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function mu(t){return t.reduce((e,r)=>(e+=yu[r],e),"")}function _u(t){const e=[];for(const r of t){const i=bu[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Eu=ti({prefix:"",name:"base256emoji",encode:mu,decode:_u}),wu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Eu},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Kr={...jh,...zh,...Bh,...Vh,...Wh,...su,...ou,...uu,...pu,...wu};function ma(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Qs=ma("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),mi=ma("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=pa(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),_a={utf8:Qs,"utf-8":Qs,hex:Kr.base16,latin1:mi,ascii:mi,binary:mi,...Kr};function Qi(t,e="utf8"){const r=_a[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function es(t,e="utf8"){const r=_a[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Zi(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Vr(t){return Qi(es(qi(t),bh),ga)}function Ea(t){const e=es(Dh,Zs),r=vh+Qi(Ih([e,t]),Zs);return[Eh,wh,r].join(_h)}function vu(t){return Qi(t,ga)}function Du(t){return es([Vr(t.header),Vr(t.payload)].join(da),mh)}function Su(t){return[Vr(t.header),Vr(t.payload),vu(t.signature)].join(da)}function en(t=rr.randomBytes(Sh)){return Xi.generateKeyPairFromSeed(t)}async function Iu(t,e,r,i,s=J.fromMiliseconds(Date.now())){const c={alg:ph,typ:yh},p=Ea(i.publicKey),h=s+r,f={iss:p,sub:t,aud:e,iat:s,exp:h},_=Du({header:c,payload:f}),m=Xi.sign(i.secretKey,_);return Su({header:c,payload:f,signature:m})}var ts={},ri={};Object.defineProperty(ri,"__esModule",{value:!0});var Qe=re,Ui=ot,xu=20;function Ou(t,e,r){for(var i=1634760805,s=857760878,c=2036477234,p=1797285236,h=r[3]<<24|r[2]<<16|r[1]<<8|r[0],f=r[7]<<24|r[6]<<16|r[5]<<8|r[4],_=r[11]<<24|r[10]<<16|r[9]<<8|r[8],m=r[15]<<24|r[14]<<16|r[13]<<8|r[12],w=r[19]<<24|r[18]<<16|r[17]<<8|r[16],N=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],D=r[31]<<24|r[30]<<16|r[29]<<8|r[28],U=e[3]<<24|e[2]<<16|e[1]<<8|e[0],x=e[7]<<24|e[6]<<16|e[5]<<8|e[4],R=e[11]<<24|e[10]<<16|e[9]<<8|e[8],o=e[15]<<24|e[14]<<16|e[13]<<8|e[12],d=i,u=s,l=c,y=p,n=h,g=f,P=_,j=m,W=w,Y=N,X=v,C=D,T=U,G=x,H=R,L=o,M=0;M<xu;M+=2)d=d+n|0,T^=d,T=T>>>32-16|T<<16,W=W+T|0,n^=W,n=n>>>32-12|n<<12,u=u+g|0,G^=u,G=G>>>32-16|G<<16,Y=Y+G|0,g^=Y,g=g>>>32-12|g<<12,l=l+P|0,H^=l,H=H>>>32-16|H<<16,X=X+H|0,P^=X,P=P>>>32-12|P<<12,y=y+j|0,L^=y,L=L>>>32-16|L<<16,C=C+L|0,j^=C,j=j>>>32-12|j<<12,l=l+P|0,H^=l,H=H>>>32-8|H<<8,X=X+H|0,P^=X,P=P>>>32-7|P<<7,y=y+j|0,L^=y,L=L>>>32-8|L<<8,C=C+L|0,j^=C,j=j>>>32-7|j<<7,u=u+g|0,G^=u,G=G>>>32-8|G<<8,Y=Y+G|0,g^=Y,g=g>>>32-7|g<<7,d=d+n|0,T^=d,T=T>>>32-8|T<<8,W=W+T|0,n^=W,n=n>>>32-7|n<<7,d=d+g|0,L^=d,L=L>>>32-16|L<<16,X=X+L|0,g^=X,g=g>>>32-12|g<<12,u=u+P|0,T^=u,T=T>>>32-16|T<<16,C=C+T|0,P^=C,P=P>>>32-12|P<<12,l=l+j|0,G^=l,G=G>>>32-16|G<<16,W=W+G|0,j^=W,j=j>>>32-12|j<<12,y=y+n|0,H^=y,H=H>>>32-16|H<<16,Y=Y+H|0,n^=Y,n=n>>>32-12|n<<12,l=l+j|0,G^=l,G=G>>>32-8|G<<8,W=W+G|0,j^=W,j=j>>>32-7|j<<7,y=y+n|0,H^=y,H=H>>>32-8|H<<8,Y=Y+H|0,n^=Y,n=n>>>32-7|n<<7,u=u+P|0,T^=u,T=T>>>32-8|T<<8,C=C+T|0,P^=C,P=P>>>32-7|P<<7,d=d+g|0,L^=d,L=L>>>32-8|L<<8,X=X+L|0,g^=X,g=g>>>32-7|g<<7;Qe.writeUint32LE(d+i|0,t,0),Qe.writeUint32LE(u+s|0,t,4),Qe.writeUint32LE(l+c|0,t,8),Qe.writeUint32LE(y+p|0,t,12),Qe.writeUint32LE(n+h|0,t,16),Qe.writeUint32LE(g+f|0,t,20),Qe.writeUint32LE(P+_|0,t,24),Qe.writeUint32LE(j+m|0,t,28),Qe.writeUint32LE(W+w|0,t,32),Qe.writeUint32LE(Y+N|0,t,36),Qe.writeUint32LE(X+v|0,t,40),Qe.writeUint32LE(C+D|0,t,44),Qe.writeUint32LE(T+U|0,t,48),Qe.writeUint32LE(G+x|0,t,52),Qe.writeUint32LE(H+R|0,t,56),Qe.writeUint32LE(L+o|0,t,60)}function wa(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var c,p;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),p=c.length-e.length,c.set(e,p)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,p=s}for(var h=new Uint8Array(64),f=0;f<r.length;f+=64){Ou(h,c,t);for(var _=f;_<f+64&&_<r.length;_++)i[_]=r[_]^h[_-f];Nu(c,0,p)}return Ui.wipe(h),s===0&&Ui.wipe(c),i}ri.streamXOR=wa;function Au(t,e,r,i){return i===void 0&&(i=0),Ui.wipe(r),wa(t,e,r,r,i)}ri.stream=Au;function Nu(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var va={},Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});function Tu(t,e,r){return~(t-1)&e|t-1&r}Lt.select=Tu;function Cu(t,e){return(t|0)-(e|0)-1>>>31&1}Lt.lessOrEqual=Cu;function Da(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Lt.compare=Da;function Pu(t,e){return t.length===0||e.length===0?!1:Da(t,e)!==0}Lt.equal=Pu;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Lt,r=ot;t.DIGEST_LENGTH=16;var i=function(){function p(h){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var f=h[0]|h[1]<<8;this._r[0]=f&8191;var _=h[2]|h[3]<<8;this._r[1]=(f>>>13|_<<3)&8191;var m=h[4]|h[5]<<8;this._r[2]=(_>>>10|m<<6)&7939;var w=h[6]|h[7]<<8;this._r[3]=(m>>>7|w<<9)&8191;var N=h[8]|h[9]<<8;this._r[4]=(w>>>4|N<<12)&255,this._r[5]=N>>>1&8190;var v=h[10]|h[11]<<8;this._r[6]=(N>>>14|v<<2)&8191;var D=h[12]|h[13]<<8;this._r[7]=(v>>>11|D<<5)&8065;var U=h[14]|h[15]<<8;this._r[8]=(D>>>8|U<<8)&8191,this._r[9]=U>>>5&127,this._pad[0]=h[16]|h[17]<<8,this._pad[1]=h[18]|h[19]<<8,this._pad[2]=h[20]|h[21]<<8,this._pad[3]=h[22]|h[23]<<8,this._pad[4]=h[24]|h[25]<<8,this._pad[5]=h[26]|h[27]<<8,this._pad[6]=h[28]|h[29]<<8,this._pad[7]=h[30]|h[31]<<8}return p.prototype._blocks=function(h,f,_){for(var m=this._fin?0:2048,w=this._h[0],N=this._h[1],v=this._h[2],D=this._h[3],U=this._h[4],x=this._h[5],R=this._h[6],o=this._h[7],d=this._h[8],u=this._h[9],l=this._r[0],y=this._r[1],n=this._r[2],g=this._r[3],P=this._r[4],j=this._r[5],W=this._r[6],Y=this._r[7],X=this._r[8],C=this._r[9];_>=16;){var T=h[f+0]|h[f+1]<<8;w+=T&8191;var G=h[f+2]|h[f+3]<<8;N+=(T>>>13|G<<3)&8191;var H=h[f+4]|h[f+5]<<8;v+=(G>>>10|H<<6)&8191;var L=h[f+6]|h[f+7]<<8;D+=(H>>>7|L<<9)&8191;var M=h[f+8]|h[f+9]<<8;U+=(L>>>4|M<<12)&8191,x+=M>>>1&8191;var $=h[f+10]|h[f+11]<<8;R+=(M>>>14|$<<2)&8191;var z=h[f+12]|h[f+13]<<8;o+=($>>>11|z<<5)&8191;var ie=h[f+14]|h[f+15]<<8;d+=(z>>>8|ie<<8)&8191,u+=ie>>>5|m;var q=0,Z=q;Z+=w*l,Z+=N*(5*C),Z+=v*(5*X),Z+=D*(5*Y),Z+=U*(5*W),q=Z>>>13,Z&=8191,Z+=x*(5*j),Z+=R*(5*P),Z+=o*(5*g),Z+=d*(5*n),Z+=u*(5*y),q+=Z>>>13,Z&=8191;var k=q;k+=w*y,k+=N*l,k+=v*(5*C),k+=D*(5*X),k+=U*(5*Y),q=k>>>13,k&=8191,k+=x*(5*W),k+=R*(5*j),k+=o*(5*P),k+=d*(5*g),k+=u*(5*n),q+=k>>>13,k&=8191;var oe=q;oe+=w*n,oe+=N*y,oe+=v*l,oe+=D*(5*C),oe+=U*(5*X),q=oe>>>13,oe&=8191,oe+=x*(5*Y),oe+=R*(5*W),oe+=o*(5*j),oe+=d*(5*P),oe+=u*(5*g),q+=oe>>>13,oe&=8191;var A=q;A+=w*g,A+=N*n,A+=v*y,A+=D*l,A+=U*(5*C),q=A>>>13,A&=8191,A+=x*(5*X),A+=R*(5*Y),A+=o*(5*W),A+=d*(5*j),A+=u*(5*P),q+=A>>>13,A&=8191;var O=q;O+=w*P,O+=N*g,O+=v*n,O+=D*y,O+=U*l,q=O>>>13,O&=8191,O+=x*(5*C),O+=R*(5*X),O+=o*(5*Y),O+=d*(5*W),O+=u*(5*j),q+=O>>>13,O&=8191;var S=q;S+=w*j,S+=N*P,S+=v*g,S+=D*n,S+=U*y,q=S>>>13,S&=8191,S+=x*l,S+=R*(5*C),S+=o*(5*X),S+=d*(5*Y),S+=u*(5*W),q+=S>>>13,S&=8191;var a=q;a+=w*W,a+=N*j,a+=v*P,a+=D*g,a+=U*n,q=a>>>13,a&=8191,a+=x*y,a+=R*l,a+=o*(5*C),a+=d*(5*X),a+=u*(5*Y),q+=a>>>13,a&=8191;var E=q;E+=w*Y,E+=N*W,E+=v*j,E+=D*P,E+=U*g,q=E>>>13,E&=8191,E+=x*n,E+=R*y,E+=o*l,E+=d*(5*C),E+=u*(5*X),q+=E>>>13,E&=8191;var B=q;B+=w*X,B+=N*Y,B+=v*W,B+=D*j,B+=U*P,q=B>>>13,B&=8191,B+=x*g,B+=R*n,B+=o*y,B+=d*l,B+=u*(5*C),q+=B>>>13,B&=8191;var K=q;K+=w*C,K+=N*X,K+=v*Y,K+=D*W,K+=U*j,q=K>>>13,K&=8191,K+=x*P,K+=R*g,K+=o*n,K+=d*y,K+=u*l,q+=K>>>13,K&=8191,q=(q<<2)+q|0,q=q+Z|0,Z=q&8191,q=q>>>13,k+=q,w=Z,N=k,v=oe,D=A,U=O,x=S,R=a,o=E,d=B,u=K,f+=16,_-=16}this._h[0]=w,this._h[1]=N,this._h[2]=v,this._h[3]=D,this._h[4]=U,this._h[5]=x,this._h[6]=R,this._h[7]=o,this._h[8]=d,this._h[9]=u},p.prototype.finish=function(h,f){f===void 0&&(f=0);var _=new Uint16Array(10),m,w,N,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(m=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=m,m=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=m*5,m=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=m,m=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=m,_[0]=this._h[0]+5,m=_[0]>>>13,_[0]&=8191,v=1;v<10;v++)_[v]=this._h[v]+m,m=_[v]>>>13,_[v]&=8191;for(_[9]-=1<<13,w=(m^1)-1,v=0;v<10;v++)_[v]&=w;for(w=~w,v=0;v<10;v++)this._h[v]=this._h[v]&w|_[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,N=this._h[0]+this._pad[0],this._h[0]=N&65535,v=1;v<8;v++)N=(this._h[v]+this._pad[v]|0)+(N>>>16)|0,this._h[v]=N&65535;return h[f+0]=this._h[0]>>>0,h[f+1]=this._h[0]>>>8,h[f+2]=this._h[1]>>>0,h[f+3]=this._h[1]>>>8,h[f+4]=this._h[2]>>>0,h[f+5]=this._h[2]>>>8,h[f+6]=this._h[3]>>>0,h[f+7]=this._h[3]>>>8,h[f+8]=this._h[4]>>>0,h[f+9]=this._h[4]>>>8,h[f+10]=this._h[5]>>>0,h[f+11]=this._h[5]>>>8,h[f+12]=this._h[6]>>>0,h[f+13]=this._h[6]>>>8,h[f+14]=this._h[7]>>>0,h[f+15]=this._h[7]>>>8,this._finished=!0,this},p.prototype.update=function(h){var f=0,_=h.length,m;if(this._leftover){m=16-this._leftover,m>_&&(m=_);for(var w=0;w<m;w++)this._buffer[this._leftover+w]=h[f+w];if(_-=m,f+=m,this._leftover+=m,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(_>=16&&(m=_-_%16,this._blocks(h,f,m),f+=m,_-=m),_){for(var w=0;w<_;w++)this._buffer[this._leftover+w]=h[f+w];this._leftover+=_}return this},p.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var h=new Uint8Array(16);return this.finish(h),h},p.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},p}();t.Poly1305=i;function s(p,h){var f=new i(p);f.update(h);var _=f.digest();return f.clean(),_}t.oneTimeAuth=s;function c(p,h){return p.length!==t.DIGEST_LENGTH||h.length!==t.DIGEST_LENGTH?!1:e.equal(p,h)}t.equal=c})(va);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ri,r=va,i=ot,s=re,c=Lt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var p=new Uint8Array(16),h=function(){function f(_){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,_.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(_)}return f.prototype.seal=function(_,m,w,N){if(_.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(_,v.length-_.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var U=m.length+this.tagLength,x;if(N){if(N.length!==U)throw new Error("ChaCha20Poly1305: incorrect destination length");x=N}else x=new Uint8Array(U);return e.streamXOR(this._key,v,m,x,4),this._authenticate(x.subarray(x.length-this.tagLength,x.length),D,x.subarray(0,x.length-this.tagLength),w),i.wipe(v),x},f.prototype.open=function(_,m,w,N){if(_.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(m.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(_,v.length-_.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var U=new Uint8Array(this.tagLength);if(this._authenticate(U,D,m.subarray(0,m.length-this.tagLength),w),!c.equal(U,m.subarray(m.length-this.tagLength,m.length)))return null;var x=m.length-this.tagLength,R;if(N){if(N.length!==x)throw new Error("ChaCha20Poly1305: incorrect destination length");R=N}else R=new Uint8Array(x);return e.streamXOR(this._key,v,m.subarray(0,m.length-this.tagLength),R,4),i.wipe(v),R},f.prototype.clean=function(){return i.wipe(this._key),this},f.prototype._authenticate=function(_,m,w,N){var v=new r.Poly1305(m);N&&(v.update(N),N.length%16>0&&v.update(p.subarray(N.length%16))),v.update(w),w.length%16>0&&v.update(p.subarray(w.length%16));var D=new Uint8Array(8);N&&s.writeUint64LE(N.length,D),v.update(D),s.writeUint64LE(w.length,D),v.update(D);for(var U=v.digest(),x=0;x<U.length;x++)_[x]=U[x];v.clean(),i.wipe(U),i.wipe(D)},f}();t.ChaCha20Poly1305=h})(ts);var Sa={},Ir={},rs={};Object.defineProperty(rs,"__esModule",{value:!0});function Uu(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}rs.isSerializableHash=Uu;Object.defineProperty(Ir,"__esModule",{value:!0});var _t=rs,Ru=Lt,Fu=ot,Ia=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),_t.isSerializableHash(this._inner)&&_t.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Fu.wipe(i)}return t.prototype.reset=function(){if(!_t.isSerializableHash(this._inner)||!_t.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){_t.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),_t.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!_t.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!_t.isSerializableHash(this._inner)||!_t.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!_t.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Ir.HMAC=Ia;function Lu(t,e,r){var i=new Ia(t,e);i.update(r);var s=i.digest();return i.clean(),s}Ir.hmac=Lu;Ir.equal=Ru.equal;Object.defineProperty(Sa,"__esModule",{value:!0});var tn=Ir,rn=ot,Mu=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var c=tn.hmac(this._hash,i,r);this._hmac=new tn.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),rn.wipe(this._buffer),rn.wipe(this._counter),this._bufpos=0},t}(),$u=Sa.HKDF=Mu,ii={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ot;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function h(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},h.prototype.update=function(f,_){if(_===void 0&&(_=f.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this._bytesHashed+=_,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&_>0;)this._buffer[this._bufferLength++]=f[m++],_--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(_>=this.blockSize&&(m=c(this._temp,this._state,f,m,_),_%=this.blockSize);_>0;)this._buffer[this._bufferLength++]=f[m++],_--;return this},h.prototype.finish=function(f){if(!this._finished){var _=this._bytesHashed,m=this._bufferLength,w=_/536870912|0,N=_<<3,v=_%64<56?64:128;this._buffer[m]=128;for(var D=m+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(w,this._buffer,v-8),e.writeUint32BE(N,this._buffer,v-4),c(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/4;D++)e.writeUint32BE(this._state[D],f,D*4);return this},h.prototype.digest=function(){var f=new Uint8Array(this.digestLength);return this.finish(f),f},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(f){return this._state.set(f.state),this._bufferLength=f.bufferLength,f.buffer&&this._buffer.set(f.buffer),this._bytesHashed=f.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(f){r.wipe(f.state),f.buffer&&r.wipe(f.buffer),f.bufferLength=0,f.bytesHashed=0},h}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(h,f,_,m,w){for(;w>=64;){for(var N=f[0],v=f[1],D=f[2],U=f[3],x=f[4],R=f[5],o=f[6],d=f[7],u=0;u<16;u++){var l=m+u*4;h[u]=e.readUint32BE(_,l)}for(var u=16;u<64;u++){var y=h[u-2],n=(y>>>17|y<<32-17)^(y>>>19|y<<32-19)^y>>>10;y=h[u-15];var g=(y>>>7|y<<32-7)^(y>>>18|y<<32-18)^y>>>3;h[u]=(n+h[u-7]|0)+(g+h[u-16]|0)}for(var u=0;u<64;u++){var n=(((x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7))+(x&R^~x&o)|0)+(d+(s[u]+h[u]|0)|0)|0,g=((N>>>2|N<<32-2)^(N>>>13|N<<32-13)^(N>>>22|N<<32-22))+(N&v^N&D^v&D)|0;d=o,o=R,R=x,x=U+n|0,U=D,D=v,v=N,N=n+g|0}f[0]+=N,f[1]+=v,f[2]+=D,f[3]+=U,f[4]+=x,f[5]+=R,f[6]+=o,f[7]+=d,m+=64,w-=64}return m}function p(h){var f=new i;f.update(h);var _=f.digest();return f.clean(),_}t.hash=p})(ii);var is={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=rr,r=ot;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(u){const l=new Float64Array(16);if(u)for(let y=0;y<u.length;y++)l[y]=u[y];return l}const s=new Uint8Array(32);s[0]=9;const c=i([56129,1]);function p(u){let l=1;for(let y=0;y<16;y++){let n=u[y]+l+65535;l=Math.floor(n/65536),u[y]=n-l*65536}u[0]+=l-1+37*(l-1)}function h(u,l,y){const n=~(y-1);for(let g=0;g<16;g++){const P=n&(u[g]^l[g]);u[g]^=P,l[g]^=P}}function f(u,l){const y=i(),n=i();for(let g=0;g<16;g++)n[g]=l[g];p(n),p(n),p(n);for(let g=0;g<2;g++){y[0]=n[0]-65517;for(let j=1;j<15;j++)y[j]=n[j]-65535-(y[j-1]>>16&1),y[j-1]&=65535;y[15]=n[15]-32767-(y[14]>>16&1);const P=y[15]>>16&1;y[14]&=65535,h(n,y,1-P)}for(let g=0;g<16;g++)u[2*g]=n[g]&255,u[2*g+1]=n[g]>>8}function _(u,l){for(let y=0;y<16;y++)u[y]=l[2*y]+(l[2*y+1]<<8);u[15]&=32767}function m(u,l,y){for(let n=0;n<16;n++)u[n]=l[n]+y[n]}function w(u,l,y){for(let n=0;n<16;n++)u[n]=l[n]-y[n]}function N(u,l,y){let n,g,P=0,j=0,W=0,Y=0,X=0,C=0,T=0,G=0,H=0,L=0,M=0,$=0,z=0,ie=0,q=0,Z=0,k=0,oe=0,A=0,O=0,S=0,a=0,E=0,B=0,K=0,le=0,be=0,de=0,Ee=0,Ue=0,Ne=0,ye=y[0],ge=y[1],fe=y[2],he=y[3],ce=y[4],ae=y[5],ne=y[6],ee=y[7],ue=y[8],pe=y[9],te=y[10],me=y[11],_e=y[12],ve=y[13],De=y[14],we=y[15];n=l[0],P+=n*ye,j+=n*ge,W+=n*fe,Y+=n*he,X+=n*ce,C+=n*ae,T+=n*ne,G+=n*ee,H+=n*ue,L+=n*pe,M+=n*te,$+=n*me,z+=n*_e,ie+=n*ve,q+=n*De,Z+=n*we,n=l[1],j+=n*ye,W+=n*ge,Y+=n*fe,X+=n*he,C+=n*ce,T+=n*ae,G+=n*ne,H+=n*ee,L+=n*ue,M+=n*pe,$+=n*te,z+=n*me,ie+=n*_e,q+=n*ve,Z+=n*De,k+=n*we,n=l[2],W+=n*ye,Y+=n*ge,X+=n*fe,C+=n*he,T+=n*ce,G+=n*ae,H+=n*ne,L+=n*ee,M+=n*ue,$+=n*pe,z+=n*te,ie+=n*me,q+=n*_e,Z+=n*ve,k+=n*De,oe+=n*we,n=l[3],Y+=n*ye,X+=n*ge,C+=n*fe,T+=n*he,G+=n*ce,H+=n*ae,L+=n*ne,M+=n*ee,$+=n*ue,z+=n*pe,ie+=n*te,q+=n*me,Z+=n*_e,k+=n*ve,oe+=n*De,A+=n*we,n=l[4],X+=n*ye,C+=n*ge,T+=n*fe,G+=n*he,H+=n*ce,L+=n*ae,M+=n*ne,$+=n*ee,z+=n*ue,ie+=n*pe,q+=n*te,Z+=n*me,k+=n*_e,oe+=n*ve,A+=n*De,O+=n*we,n=l[5],C+=n*ye,T+=n*ge,G+=n*fe,H+=n*he,L+=n*ce,M+=n*ae,$+=n*ne,z+=n*ee,ie+=n*ue,q+=n*pe,Z+=n*te,k+=n*me,oe+=n*_e,A+=n*ve,O+=n*De,S+=n*we,n=l[6],T+=n*ye,G+=n*ge,H+=n*fe,L+=n*he,M+=n*ce,$+=n*ae,z+=n*ne,ie+=n*ee,q+=n*ue,Z+=n*pe,k+=n*te,oe+=n*me,A+=n*_e,O+=n*ve,S+=n*De,a+=n*we,n=l[7],G+=n*ye,H+=n*ge,L+=n*fe,M+=n*he,$+=n*ce,z+=n*ae,ie+=n*ne,q+=n*ee,Z+=n*ue,k+=n*pe,oe+=n*te,A+=n*me,O+=n*_e,S+=n*ve,a+=n*De,E+=n*we,n=l[8],H+=n*ye,L+=n*ge,M+=n*fe,$+=n*he,z+=n*ce,ie+=n*ae,q+=n*ne,Z+=n*ee,k+=n*ue,oe+=n*pe,A+=n*te,O+=n*me,S+=n*_e,a+=n*ve,E+=n*De,B+=n*we,n=l[9],L+=n*ye,M+=n*ge,$+=n*fe,z+=n*he,ie+=n*ce,q+=n*ae,Z+=n*ne,k+=n*ee,oe+=n*ue,A+=n*pe,O+=n*te,S+=n*me,a+=n*_e,E+=n*ve,B+=n*De,K+=n*we,n=l[10],M+=n*ye,$+=n*ge,z+=n*fe,ie+=n*he,q+=n*ce,Z+=n*ae,k+=n*ne,oe+=n*ee,A+=n*ue,O+=n*pe,S+=n*te,a+=n*me,E+=n*_e,B+=n*ve,K+=n*De,le+=n*we,n=l[11],$+=n*ye,z+=n*ge,ie+=n*fe,q+=n*he,Z+=n*ce,k+=n*ae,oe+=n*ne,A+=n*ee,O+=n*ue,S+=n*pe,a+=n*te,E+=n*me,B+=n*_e,K+=n*ve,le+=n*De,be+=n*we,n=l[12],z+=n*ye,ie+=n*ge,q+=n*fe,Z+=n*he,k+=n*ce,oe+=n*ae,A+=n*ne,O+=n*ee,S+=n*ue,a+=n*pe,E+=n*te,B+=n*me,K+=n*_e,le+=n*ve,be+=n*De,de+=n*we,n=l[13],ie+=n*ye,q+=n*ge,Z+=n*fe,k+=n*he,oe+=n*ce,A+=n*ae,O+=n*ne,S+=n*ee,a+=n*ue,E+=n*pe,B+=n*te,K+=n*me,le+=n*_e,be+=n*ve,de+=n*De,Ee+=n*we,n=l[14],q+=n*ye,Z+=n*ge,k+=n*fe,oe+=n*he,A+=n*ce,O+=n*ae,S+=n*ne,a+=n*ee,E+=n*ue,B+=n*pe,K+=n*te,le+=n*me,be+=n*_e,de+=n*ve,Ee+=n*De,Ue+=n*we,n=l[15],Z+=n*ye,k+=n*ge,oe+=n*fe,A+=n*he,O+=n*ce,S+=n*ae,a+=n*ne,E+=n*ee,B+=n*ue,K+=n*pe,le+=n*te,be+=n*me,de+=n*_e,Ee+=n*ve,Ue+=n*De,Ne+=n*we,P+=38*k,j+=38*oe,W+=38*A,Y+=38*O,X+=38*S,C+=38*a,T+=38*E,G+=38*B,H+=38*K,L+=38*le,M+=38*be,$+=38*de,z+=38*Ee,ie+=38*Ue,q+=38*Ne,g=1,n=P+g+65535,g=Math.floor(n/65536),P=n-g*65536,n=j+g+65535,g=Math.floor(n/65536),j=n-g*65536,n=W+g+65535,g=Math.floor(n/65536),W=n-g*65536,n=Y+g+65535,g=Math.floor(n/65536),Y=n-g*65536,n=X+g+65535,g=Math.floor(n/65536),X=n-g*65536,n=C+g+65535,g=Math.floor(n/65536),C=n-g*65536,n=T+g+65535,g=Math.floor(n/65536),T=n-g*65536,n=G+g+65535,g=Math.floor(n/65536),G=n-g*65536,n=H+g+65535,g=Math.floor(n/65536),H=n-g*65536,n=L+g+65535,g=Math.floor(n/65536),L=n-g*65536,n=M+g+65535,g=Math.floor(n/65536),M=n-g*65536,n=$+g+65535,g=Math.floor(n/65536),$=n-g*65536,n=z+g+65535,g=Math.floor(n/65536),z=n-g*65536,n=ie+g+65535,g=Math.floor(n/65536),ie=n-g*65536,n=q+g+65535,g=Math.floor(n/65536),q=n-g*65536,n=Z+g+65535,g=Math.floor(n/65536),Z=n-g*65536,P+=g-1+37*(g-1),g=1,n=P+g+65535,g=Math.floor(n/65536),P=n-g*65536,n=j+g+65535,g=Math.floor(n/65536),j=n-g*65536,n=W+g+65535,g=Math.floor(n/65536),W=n-g*65536,n=Y+g+65535,g=Math.floor(n/65536),Y=n-g*65536,n=X+g+65535,g=Math.floor(n/65536),X=n-g*65536,n=C+g+65535,g=Math.floor(n/65536),C=n-g*65536,n=T+g+65535,g=Math.floor(n/65536),T=n-g*65536,n=G+g+65535,g=Math.floor(n/65536),G=n-g*65536,n=H+g+65535,g=Math.floor(n/65536),H=n-g*65536,n=L+g+65535,g=Math.floor(n/65536),L=n-g*65536,n=M+g+65535,g=Math.floor(n/65536),M=n-g*65536,n=$+g+65535,g=Math.floor(n/65536),$=n-g*65536,n=z+g+65535,g=Math.floor(n/65536),z=n-g*65536,n=ie+g+65535,g=Math.floor(n/65536),ie=n-g*65536,n=q+g+65535,g=Math.floor(n/65536),q=n-g*65536,n=Z+g+65535,g=Math.floor(n/65536),Z=n-g*65536,P+=g-1+37*(g-1),u[0]=P,u[1]=j,u[2]=W,u[3]=Y,u[4]=X,u[5]=C,u[6]=T,u[7]=G,u[8]=H,u[9]=L,u[10]=M,u[11]=$,u[12]=z,u[13]=ie,u[14]=q,u[15]=Z}function v(u,l){N(u,l,l)}function D(u,l){const y=i();for(let n=0;n<16;n++)y[n]=l[n];for(let n=253;n>=0;n--)v(y,y),n!==2&&n!==4&&N(y,y,l);for(let n=0;n<16;n++)u[n]=y[n]}function U(u,l){const y=new Uint8Array(32),n=new Float64Array(80),g=i(),P=i(),j=i(),W=i(),Y=i(),X=i();for(let H=0;H<31;H++)y[H]=u[H];y[31]=u[31]&127|64,y[0]&=248,_(n,l);for(let H=0;H<16;H++)P[H]=n[H];g[0]=W[0]=1;for(let H=254;H>=0;--H){const L=y[H>>>3]>>>(H&7)&1;h(g,P,L),h(j,W,L),m(Y,g,j),w(g,g,j),m(j,P,W),w(P,P,W),v(W,Y),v(X,g),N(g,j,g),N(j,P,Y),m(Y,g,j),w(g,g,j),v(P,g),w(j,W,X),N(g,j,c),m(g,g,W),N(j,j,g),N(g,W,X),N(W,P,n),v(P,Y),h(g,P,L),h(j,W,L)}for(let H=0;H<16;H++)n[H+16]=g[H],n[H+32]=j[H],n[H+48]=P[H],n[H+64]=W[H];const C=n.subarray(32),T=n.subarray(16);D(C,C),N(T,T,C);const G=new Uint8Array(32);return f(G,T),G}t.scalarMult=U;function x(u){return U(u,s)}t.scalarMultBase=x;function R(u){if(u.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const l=new Uint8Array(u);return{publicKey:x(l),secretKey:l}}t.generateKeyPairFromSeed=R;function o(u){const l=(0,e.randomBytes)(32,u),y=R(l);return(0,r.wipe)(l),y}t.generateKeyPair=o;function d(u,l,y=!1){if(u.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(l.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=U(u,l);if(y){let g=0;for(let P=0;P<n.length;P++)g|=n[P];if(g===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=d})(is);function xa(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function sn(t,e){e||(e=t.reduce((s,c)=>s+c.length,0));const r=xa(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return r}function Oa(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const nn=Oa("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),_i=Oa("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=xa(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Aa={utf8:nn,"utf-8":nn,hex:Kr.base16,latin1:_i,ascii:_i,binary:_i,...Kr};function pt(t,e="utf8"){const r=Aa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function yt(t,e="utf8"){const r=Aa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var an=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,c;i<s;i++)(c||!(i in e))&&(c||(c=Array.prototype.slice.call(e,0,i)),c[i]=e[i]);return t.concat(c||Array.prototype.slice.call(e))},ju=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Hu=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=kt.platform}return t}(),zu=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),qu=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Bu=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Ku=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Vu=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,on=3,Gu=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Ku]],cn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function ku(t){return t?hn(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Bu:typeof navigator<"u"?hn(navigator.userAgent):Ju()}function Wu(t){return t!==""&&Gu.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var c=s.exec(t);return!!c&&[i,c]},!1)}function hn(t){var e=Wu(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new qu;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<on&&(s=an(an([],s,!0),Xu(on-s.length),!0)):s=[];var c=s.join("."),p=Yu(t),h=Vu.exec(t);return h&&h[1]?new zu(r,c,p,h[1]):new ju(r,c,p)}function Yu(t){for(var e=0,r=cn.length;e<r;e++){var i=cn[e],s=i[0],c=i[1],p=c.exec(t);if(p)return s}return null}function Ju(){var t=typeof kt<"u"&&kt.version;return t?new Hu(kt.version.slice(1)):null}function Xu(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ss={};Object.defineProperty(ss,"__esModule",{value:!0});ss.getWindowMetadata=void 0;const un=Bi;function Zu(){let t,e;try{t=un.getDocumentOrThrow(),e=un.getLocationOrThrow()}catch{return null}function r(){const w=t.getElementsByTagName("link"),N=[];for(let v=0;v<w.length;v++){const D=w[v],U=D.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const x=D.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(x.indexOf("/")===0)R+=x;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");R+=d+"/"+x}N.push(R)}else if(x.indexOf("//")===0){const R=e.protocol+x;N.push(R)}else N.push(x)}}return N}function i(...w){const N=t.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],U=["itemprop","property","name"].map(x=>D.getAttribute(x)).filter(x=>x?w.includes(x):!1);if(U.length&&U){const x=D.getAttribute("content");if(x)return x}}return""}function s(){let w=i("name","og:site_name","og:title","twitter:title");return w||(w=t.title),w}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),h=c(),f=e.origin,_=r();return{description:h,url:f,icons:_,name:p}}ss.getWindowMetadata=Zu;var _r={},ns=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),c=0;c<i.length;c++){var p=i[c],h=t[p];(s?e.indexOf(p)!==-1:e(p,h,t))&&(r[p]=h)}return r};(function(t){const e=Vi,r=Gi,i=Ki,s=ns,c=o=>o==null,p=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,l)=>{const y=u.length;return l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[",y,"]"].join("")]:[...u,[m(d,o),"[",m(y,o),"]=",m(l,o)].join("")]};case"bracket":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(l,o)].join("")];case"colon-list-separator":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(l,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(l,y)=>y===void 0||o.skipNull&&y===null||o.skipEmptyString&&y===""?l:(y=y===null?"":y,l.length===0?[[m(u,o),d,m(y,o)].join("")]:[[l,m(y,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(l,o)].join("")]}}function f(o){let d;switch(o.arrayFormat){case"index":return(u,l,y)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){y[u]=l;return}y[u]===void 0&&(y[u]={}),y[u][d[1]]=l};case"bracket":return(u,l,y)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"colon-list-separator":return(u,l,y)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"comma":case"separator":return(u,l,y)=>{const n=typeof l=="string"&&l.includes(o.arrayFormatSeparator),g=typeof l=="string"&&!n&&w(l,o).includes(o.arrayFormatSeparator);l=g?w(l,o):l;const P=n||g?l.split(o.arrayFormatSeparator).map(j=>w(j,o)):l===null?l:w(l,o);y[u]=P};case"bracket-separator":return(u,l,y)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){y[u]=l&&w(l,o);return}const g=l===null?[]:l.split(o.arrayFormatSeparator).map(P=>w(P,o));if(y[u]===void 0){y[u]=g;return}y[u]=[].concat(y[u],g)};default:return(u,l,y)=>{if(y[u]===void 0){y[u]=l;return}y[u]=[].concat(y[u],l)}}}function _(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function w(o,d){return d.decode?r(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function U(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function x(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function R(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const u=f(d),l=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return l;for(const y of o.split("&")){if(y==="")continue;let[n,g]=i(d.decode?y.replace(/\+/g," "):y,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?g:w(g,d),u(w(n,d),g,l)}for(const y of Object.keys(l)){const n=l[y];if(typeof n=="object"&&n!==null)for(const g of Object.keys(n))n[g]=x(n[g],d);else l[y]=x(n,d)}return d.sort===!1?l:(d.sort===!0?Object.keys(l).sort():Object.keys(l).sort(d.sort)).reduce((y,n)=>{const g=l[n];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?y[n]=N(g):y[n]=g,y},Object.create(null))}t.extract=U,t.parse=R,t.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const u=g=>d.skipNull&&c(o[g])||d.skipEmptyString&&o[g]==="",l=h(d),y={};for(const g of Object.keys(o))u(g)||(y[g]=o[g]);const n=Object.keys(y);return d.sort!==!1&&n.sort(d.sort),n.map(g=>{const P=o[g];return P===void 0?"":P===null?m(g,d):Array.isArray(P)?P.length===0&&d.arrayFormat==="bracket-separator"?m(g,d)+"[]":P.reduce(l(g),[]).join("&"):m(g,d)+"="+m(P,d)}).filter(g=>g.length>0).join("&")},t.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,l]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:R(U(o),d)},d&&d.parseFragmentIdentifier&&l?{fragmentIdentifier:w(l,d)}:{})},t.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[p]:!0},d);const u=v(o.url).split("?")[0]||"",l=t.extract(o.url),y=t.parse(l,{sort:!1}),n=Object.assign(y,o.query);let g=t.stringify(n,d);g&&(g=`?${g}`);let P=D(o.url);return o.fragmentIdentifier&&(P=`#${d[p]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${g}${P}`},t.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[p]:!1},u);const{url:l,query:y,fragmentIdentifier:n}=t.parseUrl(o,u);return t.stringifyUrl({url:l,query:s(y,d),fragmentIdentifier:n},u)},t.exclude=(o,d,u)=>{const l=Array.isArray(d)?y=>!d.includes(y):(y,n)=>!d(y,n);return t.pick(o,l,u)}})(_r);const Qu={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},Na="base10",it="base16",Ri="base64pad",as="utf8",Ta=0,ir=1,el=0,ln=1,Fi=12,os=32;function tl(){const t=is.generateKeyPair();return{privateKey:yt(t.secretKey,it),publicKey:yt(t.publicKey,it)}}function Li(){const t=rr.randomBytes(os);return yt(t,it)}function rl(t,e){const r=is.sharedKey(pt(t,it),pt(e,it)),i=new $u(ii.SHA256,r).expand(os);return yt(i,it)}function il(t){const e=ii.hash(pt(t,it));return yt(e,it)}function Mi(t){const e=ii.hash(pt(t,as));return yt(e,it)}function sl(t){return pt(`${t}`,Na)}function xr(t){return Number(yt(t,Na))}function nl(t){const e=sl(typeof t.type<"u"?t.type:Ta);if(xr(e)===ir&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?pt(t.senderPublicKey,it):void 0,i=typeof t.iv<"u"?pt(t.iv,it):rr.randomBytes(Fi),s=new ts.ChaCha20Poly1305(pt(t.symKey,it)).seal(i,pt(t.message,as));return ol({type:e,sealed:s,iv:i,senderPublicKey:r})}function al(t){const e=new ts.ChaCha20Poly1305(pt(t.symKey,it)),{sealed:r,iv:i}=cs(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return yt(s,as)}function ol(t){if(xr(t.type)===ir){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return yt(sn([t.type,t.senderPublicKey,t.iv,t.sealed]),Ri)}return yt(sn([t.type,t.iv,t.sealed]),Ri)}function cs(t){const e=pt(t,Ri),r=e.slice(el,ln),i=ln;if(xr(r)===ir){const h=i+os,f=h+Fi,_=e.slice(i,h),m=e.slice(h,f),w=e.slice(f);return{type:r,sealed:w,iv:m,senderPublicKey:_}}const s=i+Fi,c=e.slice(i,s),p=e.slice(s);return{type:r,sealed:p,iv:c}}function cl(t,e){const r=cs(t);return Ca({type:xr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?yt(r.senderPublicKey,it):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ca(t){const e=(t==null?void 0:t.type)||Ta;if(e===ir){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function fn(t){return t.type===ir&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var hl=Object.defineProperty,dn=Object.getOwnPropertySymbols,ul=Object.prototype.hasOwnProperty,ll=Object.prototype.propertyIsEnumerable,gn=(t,e,r)=>e in t?hl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pn=(t,e)=>{for(var r in e||(e={}))ul.call(e,r)&&gn(t,r,e[r]);if(dn)for(var r of dn(e))ll.call(e,r)&&gn(t,r,e[r]);return t};const fl="ReactNative",pr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},dl="js";function Pa(){return typeof kt<"u"&&typeof kt.versions<"u"&&typeof kt.versions.node<"u"}function gl(){return!ko()&&!!Jn()&&navigator.product===fl}function pl(){return!Pa()&&!!Jn()}function yl(){return gl()?pr.reactNative:Pa()?pr.node:pl()?pr.browser:pr.unknown}function bl(t,e){let r=_r.parse(t);return r=pn(pn({},r),e),t=_r.stringify(r),t}function ml(){const t=ku();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function _l(){var t;const e=yl();return e===pr.browser?[e,((t=Go())==null?void 0:t.host)||"unknown"].join(":"):e}function El(t,e,r){const i=ml(),s=_l();return[[t,e].join("-"),[dl,r].join("-"),i,s].join("/")}function wl({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:c}){const p=r.split("?"),h=El(t,e,i),f={auth:s,ua:h,projectId:c},_=bl(p[1]||"",f);return p[0]+"?"+_}function Ua(t){return Object.fromEntries(t.entries())}function Ra(t){return new Map(Object.entries(t))}function Ei(t,e){return J.fromMiliseconds((e||Date.now())+J.toMiliseconds(t))}function yn(t){return J.fromMiliseconds(Date.now())>=J.toMiliseconds(t)}function vl(t){const e=J.toMiliseconds(t||J.FIVE_MINUTES);let r,i,s;return{resolve:c=>{s&&r&&(clearTimeout(s),r(c))},reject:c=>{s&&i&&(clearTimeout(s),i(c))},done:()=>new Promise((c,p)=>{s=setTimeout(p,e),r=c,i=p})}}function Fa(t,e){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(),e),c=await t;clearTimeout(s),r(c)})}function La(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Dl(t){return La("topic",t)}function Sl(t){return La("id",t)}function Il(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function wi(t,e){return`${t}${e?`:${e}`:""}`}const xl="irn";function $i(t){return(t==null?void 0:t.relay)||{protocol:xl}}function ji(t){const e=Qu[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Ol=Object.defineProperty,bn=Object.getOwnPropertySymbols,Al=Object.prototype.hasOwnProperty,Nl=Object.prototype.propertyIsEnumerable,mn=(t,e,r)=>e in t?Ol(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tl=(t,e)=>{for(var r in e||(e={}))Al.call(e,r)&&mn(t,r,e[r]);if(bn)for(var r of bn(e))Nl.call(e,r)&&mn(t,r,e[r]);return t};function Cl(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const c=s.replace(i,""),p=t[s];r[c]=p}}),r}function Pl(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),c=typeof r<"u"?t.substring(r):"",p=_r.parse(c);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:p.symKey,relay:Cl(p)}}function Ul(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const c=r+e+s;t[s]&&(i[c]=t[s])}),i}function Rl(t){return`${t.protocol}:${t.topic}@${t.version}?`+_r.stringify(Tl({symKey:t.symKey},Ul(t.relay)))}const Fl={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Ll={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Ie(t,e){const{message:r,code:i}=Ll[t];return{message:e?`${r} ${e}`:r,code:i}}function yr(t,e){const{message:r,code:i}=Fl[t];return{message:e?`${r} ${e}`:r,code:i}}function Gr(t){return typeof t>"u"}function Ma(t,e){return e&&Gr(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function Ml(t){if(Ma(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function $l(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function jl(t){return t==null?void 0:t.topic}function vi(t){return typeof t<"u"&&typeof t!==null}const _n=10,Hl=()=>typeof ci<"u"&&typeof ci.WebSocket<"u"?ci.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),zl=()=>typeof window<"u",ql=Hl();class Bl{constructor(e){if(this.url=e,this.events=new lt.EventEmitter,this.registering=!1,!As(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=()=>{this.onClose(),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(qi(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!As(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Wo.isReactNative()?void 0:{rejectUnauthorized:!Yo(e)},c=new ql(e,[],s);zl()?c.onerror=p=>{const h=p;i(this.emitError(h.error))}:c.on("error",p=>{i(this.emitError(p))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Xn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),c=ki(e,s);this.events.emit("payload",c)}parseError(e,r=this.url){return Jo(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>_n&&this.events.setMaxListeners(_n)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var kr={},Kl={get exports(){return kr},set exports(t){kr=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,c=2,p=9007199254740991,h="[object Arguments]",f="[object Array]",_="[object AsyncFunction]",m="[object Boolean]",w="[object Date]",N="[object Error]",v="[object Function]",D="[object GeneratorFunction]",U="[object Map]",x="[object Number]",R="[object Null]",o="[object Object]",d="[object Promise]",u="[object Proxy]",l="[object RegExp]",y="[object Set]",n="[object String]",g="[object Symbol]",P="[object Undefined]",j="[object WeakMap]",W="[object ArrayBuffer]",Y="[object DataView]",X="[object Float32Array]",C="[object Float64Array]",T="[object Int8Array]",G="[object Int16Array]",H="[object Int32Array]",L="[object Uint8Array]",M="[object Uint8ClampedArray]",$="[object Uint16Array]",z="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,k={};k[X]=k[C]=k[T]=k[G]=k[H]=k[L]=k[M]=k[$]=k[z]=!0,k[h]=k[f]=k[W]=k[m]=k[Y]=k[w]=k[N]=k[v]=k[U]=k[x]=k[o]=k[l]=k[y]=k[n]=k[j]=!1;var oe=typeof Gt=="object"&&Gt&&Gt.Object===Object&&Gt,A=typeof self=="object"&&self&&self.Object===Object&&self,O=oe||A||Function("return this")(),S=e&&!e.nodeType&&e,a=S&&!0&&t&&!t.nodeType&&t,E=a&&a.exports===S,B=E&&oe.process,K=function(){try{return B&&B.binding&&B.binding("util")}catch{}}(),le=K&&K.isTypedArray;function be(b,I){for(var F=-1,V=b==null?0:b.length,xe=0,se=[];++F<V;){var Pe=b[F];I(Pe,F,b)&&(se[xe++]=Pe)}return se}function de(b,I){for(var F=-1,V=I.length,xe=b.length;++F<V;)b[xe+F]=I[F];return b}function Ee(b,I){for(var F=-1,V=b==null?0:b.length;++F<V;)if(I(b[F],F,b))return!0;return!1}function Ue(b,I){for(var F=-1,V=Array(b);++F<b;)V[F]=I(F);return V}function Ne(b){return function(I){return b(I)}}function ye(b,I){return b.has(I)}function ge(b,I){return b==null?void 0:b[I]}function fe(b){var I=-1,F=Array(b.size);return b.forEach(function(V,xe){F[++I]=[xe,V]}),F}function he(b,I){return function(F){return b(I(F))}}function ce(b){var I=-1,F=Array(b.size);return b.forEach(function(V){F[++I]=V}),F}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=O["__core-js_shared__"],pe=ne.toString,te=ee.hasOwnProperty,me=function(){var b=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),_e=ee.toString,ve=RegExp("^"+pe.call(te).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=E?O.Buffer:void 0,we=O.Symbol,ft=O.Uint8Array,mt=ee.propertyIsEnumerable,At=ae.splice,st=we?we.toStringTag:void 0,Mt=Object.getOwnPropertySymbols,sr=De?De.isBuffer:void 0,Nr=he(Object.keys,Object),Re=Yt(O,"DataView"),Te=Yt(O,"Map"),Fe=Yt(O,"Promise"),Le=Yt(O,"Set"),Me=Yt(O,"WeakMap"),Ce=Yt(Object,"create"),He=jt(Re),ze=jt(Te),qe=jt(Fe),Be=jt(Le),Ke=jt(Me),je=we?we.prototype:void 0,$e=je?je.valueOf:void 0;function Oe(b){var I=-1,F=b==null?0:b.length;for(this.clear();++I<F;){var V=b[I];this.set(V[0],V[1])}}function Ve(){this.__data__=Ce?Ce(null):{},this.size=0}function Ge(b){var I=this.has(b)&&delete this.__data__[b];return this.size-=I?1:0,I}function ro(b){var I=this.__data__;if(Ce){var F=I[b];return F===i?void 0:F}return te.call(I,b)?I[b]:void 0}function io(b){var I=this.__data__;return Ce?I[b]!==void 0:te.call(I,b)}function so(b,I){var F=this.__data__;return this.size+=this.has(b)?0:1,F[b]=Ce&&I===void 0?i:I,this}Oe.prototype.clear=Ve,Oe.prototype.delete=Ge,Oe.prototype.get=ro,Oe.prototype.has=io,Oe.prototype.set=so;function Dt(b){var I=-1,F=b==null?0:b.length;for(this.clear();++I<F;){var V=b[I];this.set(V[0],V[1])}}function no(){this.__data__=[],this.size=0}function ao(b){var I=this.__data__,F=Cr(I,b);if(F<0)return!1;var V=I.length-1;return F==V?I.pop():At.call(I,F,1),--this.size,!0}function oo(b){var I=this.__data__,F=Cr(I,b);return F<0?void 0:I[F][1]}function co(b){return Cr(this.__data__,b)>-1}function ho(b,I){var F=this.__data__,V=Cr(F,b);return V<0?(++this.size,F.push([b,I])):F[V][1]=I,this}Dt.prototype.clear=no,Dt.prototype.delete=ao,Dt.prototype.get=oo,Dt.prototype.has=co,Dt.prototype.set=ho;function $t(b){var I=-1,F=b==null?0:b.length;for(this.clear();++I<F;){var V=b[I];this.set(V[0],V[1])}}function uo(){this.size=0,this.__data__={hash:new Oe,map:new(Te||Dt),string:new Oe}}function lo(b){var I=Pr(this,b).delete(b);return this.size-=I?1:0,I}function fo(b){return Pr(this,b).get(b)}function go(b){return Pr(this,b).has(b)}function po(b,I){var F=Pr(this,b),V=F.size;return F.set(b,I),this.size+=F.size==V?0:1,this}$t.prototype.clear=uo,$t.prototype.delete=lo,$t.prototype.get=fo,$t.prototype.has=go,$t.prototype.set=po;function Tr(b){var I=-1,F=b==null?0:b.length;for(this.__data__=new $t;++I<F;)this.add(b[I])}function yo(b){return this.__data__.set(b,i),this}function bo(b){return this.__data__.has(b)}Tr.prototype.add=Tr.prototype.push=yo,Tr.prototype.has=bo;function Nt(b){var I=this.__data__=new Dt(b);this.size=I.size}function mo(){this.__data__=new Dt,this.size=0}function _o(b){var I=this.__data__,F=I.delete(b);return this.size=I.size,F}function Eo(b){return this.__data__.get(b)}function wo(b){return this.__data__.has(b)}function vo(b,I){var F=this.__data__;if(F instanceof Dt){var V=F.__data__;if(!Te||V.length<r-1)return V.push([b,I]),this.size=++F.size,this;F=this.__data__=new $t(V)}return F.set(b,I),this.size=F.size,this}Nt.prototype.clear=mo,Nt.prototype.delete=_o,Nt.prototype.get=Eo,Nt.prototype.has=wo,Nt.prototype.set=vo;function Do(b,I){var F=Ur(b),V=!F&&$o(b),xe=!F&&!V&&oi(b),se=!F&&!V&&!xe&&xs(b),Pe=F||V||xe||se,ke=Pe?Ue(b.length,String):[],Ye=ke.length;for(var Ae in b)(I||te.call(b,Ae))&&!(Pe&&(Ae=="length"||xe&&(Ae=="offset"||Ae=="parent")||se&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||Uo(Ae,Ye)))&&ke.push(Ae);return ke}function Cr(b,I){for(var F=b.length;F--;)if(vs(b[F][0],I))return F;return-1}function So(b,I,F){var V=I(b);return Ur(b)?V:de(V,F(b))}function nr(b){return b==null?b===void 0?P:R:st&&st in Object(b)?Co(b):Mo(b)}function ms(b){return ar(b)&&nr(b)==h}function _s(b,I,F,V,xe){return b===I?!0:b==null||I==null||!ar(b)&&!ar(I)?b!==b&&I!==I:Io(b,I,F,V,_s,xe)}function Io(b,I,F,V,xe,se){var Pe=Ur(b),ke=Ur(I),Ye=Pe?f:Tt(b),Ae=ke?f:Tt(I);Ye=Ye==h?o:Ye,Ae=Ae==h?o:Ae;var nt=Ye==o,dt=Ae==o,Ze=Ye==Ae;if(Ze&&oi(b)){if(!oi(I))return!1;Pe=!0,nt=!1}if(Ze&&!nt)return se||(se=new Nt),Pe||xs(b)?Es(b,I,F,V,xe,se):No(b,I,Ye,F,V,xe,se);if(!(F&s)){var ct=nt&&te.call(b,"__wrapped__"),ht=dt&&te.call(I,"__wrapped__");if(ct||ht){var Ct=ct?b.value():b,St=ht?I.value():I;return se||(se=new Nt),xe(Ct,St,F,V,se)}}return Ze?(se||(se=new Nt),To(b,I,F,V,xe,se)):!1}function xo(b){if(!Is(b)||Fo(b))return!1;var I=Ds(b)?ve:q;return I.test(jt(b))}function Oo(b){return ar(b)&&Ss(b.length)&&!!k[nr(b)]}function Ao(b){if(!Lo(b))return Nr(b);var I=[];for(var F in Object(b))te.call(b,F)&&F!="constructor"&&I.push(F);return I}function Es(b,I,F,V,xe,se){var Pe=F&s,ke=b.length,Ye=I.length;if(ke!=Ye&&!(Pe&&Ye>ke))return!1;var Ae=se.get(b);if(Ae&&se.get(I))return Ae==I;var nt=-1,dt=!0,Ze=F&c?new Tr:void 0;for(se.set(b,I),se.set(I,b);++nt<ke;){var ct=b[nt],ht=I[nt];if(V)var Ct=Pe?V(ht,ct,nt,I,b,se):V(ct,ht,nt,b,I,se);if(Ct!==void 0){if(Ct)continue;dt=!1;break}if(Ze){if(!Ee(I,function(St,Ht){if(!ye(Ze,Ht)&&(ct===St||xe(ct,St,F,V,se)))return Ze.push(Ht)})){dt=!1;break}}else if(!(ct===ht||xe(ct,ht,F,V,se))){dt=!1;break}}return se.delete(b),se.delete(I),dt}function No(b,I,F,V,xe,se,Pe){switch(F){case Y:if(b.byteLength!=I.byteLength||b.byteOffset!=I.byteOffset)return!1;b=b.buffer,I=I.buffer;case W:return!(b.byteLength!=I.byteLength||!se(new ft(b),new ft(I)));case m:case w:case x:return vs(+b,+I);case N:return b.name==I.name&&b.message==I.message;case l:case n:return b==I+"";case U:var ke=fe;case y:var Ye=V&s;if(ke||(ke=ce),b.size!=I.size&&!Ye)return!1;var Ae=Pe.get(b);if(Ae)return Ae==I;V|=c,Pe.set(b,I);var nt=Es(ke(b),ke(I),V,xe,se,Pe);return Pe.delete(b),nt;case g:if($e)return $e.call(b)==$e.call(I)}return!1}function To(b,I,F,V,xe,se){var Pe=F&s,ke=ws(b),Ye=ke.length,Ae=ws(I),nt=Ae.length;if(Ye!=nt&&!Pe)return!1;for(var dt=Ye;dt--;){var Ze=ke[dt];if(!(Pe?Ze in I:te.call(I,Ze)))return!1}var ct=se.get(b);if(ct&&se.get(I))return ct==I;var ht=!0;se.set(b,I),se.set(I,b);for(var Ct=Pe;++dt<Ye;){Ze=ke[dt];var St=b[Ze],Ht=I[Ze];if(V)var Os=Pe?V(Ht,St,Ze,I,b,se):V(St,Ht,Ze,b,I,se);if(!(Os===void 0?St===Ht||xe(St,Ht,F,V,se):Os)){ht=!1;break}Ct||(Ct=Ze=="constructor")}if(ht&&!Ct){var Rr=b.constructor,Fr=I.constructor;Rr!=Fr&&"constructor"in b&&"constructor"in I&&!(typeof Rr=="function"&&Rr instanceof Rr&&typeof Fr=="function"&&Fr instanceof Fr)&&(ht=!1)}return se.delete(b),se.delete(I),ht}function ws(b){return So(b,zo,Po)}function Pr(b,I){var F=b.__data__;return Ro(I)?F[typeof I=="string"?"string":"hash"]:F.map}function Yt(b,I){var F=ge(b,I);return xo(F)?F:void 0}function Co(b){var I=te.call(b,st),F=b[st];try{b[st]=void 0;var V=!0}catch{}var xe=_e.call(b);return V&&(I?b[st]=F:delete b[st]),xe}var Po=Mt?function(b){return b==null?[]:(b=Object(b),be(Mt(b),function(I){return mt.call(b,I)}))}:qo,Tt=nr;(Re&&Tt(new Re(new ArrayBuffer(1)))!=Y||Te&&Tt(new Te)!=U||Fe&&Tt(Fe.resolve())!=d||Le&&Tt(new Le)!=y||Me&&Tt(new Me)!=j)&&(Tt=function(b){var I=nr(b),F=I==o?b.constructor:void 0,V=F?jt(F):"";if(V)switch(V){case He:return Y;case ze:return U;case qe:return d;case Be:return y;case Ke:return j}return I});function Uo(b,I){return I=I??p,!!I&&(typeof b=="number"||Z.test(b))&&b>-1&&b%1==0&&b<I}function Ro(b){var I=typeof b;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?b!=="__proto__":b===null}function Fo(b){return!!me&&me in b}function Lo(b){var I=b&&b.constructor,F=typeof I=="function"&&I.prototype||ee;return b===F}function Mo(b){return _e.call(b)}function jt(b){if(b!=null){try{return pe.call(b)}catch{}try{return b+""}catch{}}return""}function vs(b,I){return b===I||b!==b&&I!==I}var $o=ms(function(){return arguments}())?ms:function(b){return ar(b)&&te.call(b,"callee")&&!mt.call(b,"callee")},Ur=Array.isArray;function jo(b){return b!=null&&Ss(b.length)&&!Ds(b)}var oi=sr||Bo;function Ho(b,I){return _s(b,I)}function Ds(b){if(!Is(b))return!1;var I=nr(b);return I==v||I==D||I==_||I==u}function Ss(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=p}function Is(b){var I=typeof b;return b!=null&&(I=="object"||I=="function")}function ar(b){return b!=null&&typeof b=="object"}var xs=le?Ne(le):Oo;function zo(b){return jo(b)?Do(b):Ao(b)}function qo(){return[]}function Bo(){return!1}t.exports=Ho})(Kl,kr);function Vl(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=s}var h=t.length,f=t.charAt(0),_=Math.log(h)/Math.log(256),m=Math.log(256)/Math.log(h);function w(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var U=0,x=0,R=0,o=D.length;R!==o&&D[R]===0;)R++,U++;for(var d=(o-R)*m+1>>>0,u=new Uint8Array(d);R!==o;){for(var l=D[R],y=0,n=d-1;(l!==0||y<x)&&n!==-1;n--,y++)l+=256*u[n]>>>0,u[n]=l%h>>>0,l=l/h>>>0;if(l!==0)throw new Error("Non-zero carry");x=y,R++}for(var g=d-x;g!==d&&u[g]===0;)g++;for(var P=f.repeat(U);g<d;++g)P+=t.charAt(u[g]);return P}function N(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var U=0;if(D[U]!==" "){for(var x=0,R=0;D[U]===f;)x++,U++;for(var o=(D.length-U)*_+1>>>0,d=new Uint8Array(o);D[U];){var u=r[D.charCodeAt(U)];if(u===255)return;for(var l=0,y=o-1;(u!==0||l<R)&&y!==-1;y--,l++)u+=h*d[y]>>>0,d[y]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");R=l,U++}if(D[U]!==" "){for(var n=o-R;n!==o&&d[n]===0;)n++;for(var g=new Uint8Array(x+(o-n)),P=x;n!==o;)g[P++]=d[n++];return g}}}function v(D){var U=N(D);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:w,decodeUnsafe:N,decode:v}}var Gl=Vl,kl=Gl;const $a=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Wl=t=>new TextEncoder().encode(t),Yl=t=>new TextDecoder().decode(t);class Jl{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Xl{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ja(this,e)}}class Zl{constructor(e){this.decoders=e}or(e){return ja(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ja=(t,e)=>new Zl({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Ql{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Jl(e,r,i),this.decoder=new Xl(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const si=({name:t,prefix:e,encode:r,decode:i})=>new Ql(t,e,r,i),Or=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=kl(r,e);return si({prefix:t,name:e,encode:i,decode:c=>$a(s(c))})},ef=(t,e,r,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let h=0,f=0,_=0;for(let m=0;m<c;++m){const w=s[t[m]];if(w===void 0)throw new SyntaxError(`Non-${i} character`);f=f<<r|w,h+=r,h>=8&&(h-=8,p[_++]=255&f>>h)}if(h>=r||255&f<<8-h)throw new SyntaxError("Unexpected end of data");return p},tf=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",p=0,h=0;for(let f=0;f<t.length;++f)for(h=h<<8|t[f],p+=8;p>r;)p-=r,c+=e[s&h>>p];if(p&&(c+=e[s&h<<r-p]),i)for(;c.length*r&7;)c+="=";return c},Xe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>si({prefix:e,name:t,encode(s){return tf(s,i,r)},decode(s){return ef(s,i,r,t)}}),rf=si({prefix:"\0",name:"identity",encode:t=>Yl(t),decode:t=>Wl(t)});var sf=Object.freeze({__proto__:null,identity:rf});const nf=Xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var af=Object.freeze({__proto__:null,base2:nf});const of=Xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var cf=Object.freeze({__proto__:null,base8:of});const hf=Or({prefix:"9",name:"base10",alphabet:"0123456789"});var uf=Object.freeze({__proto__:null,base10:hf});const lf=Xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ff=Xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var df=Object.freeze({__proto__:null,base16:lf,base16upper:ff});const gf=Xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),pf=Xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yf=Xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bf=Xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mf=Xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_f=Xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ef=Xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),wf=Xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vf=Xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Df=Object.freeze({__proto__:null,base32:gf,base32upper:pf,base32pad:yf,base32padupper:bf,base32hex:mf,base32hexupper:_f,base32hexpad:Ef,base32hexpadupper:wf,base32z:vf});const Sf=Or({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),If=Or({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var xf=Object.freeze({__proto__:null,base36:Sf,base36upper:If});const Of=Or({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Af=Or({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Nf=Object.freeze({__proto__:null,base58btc:Of,base58flickr:Af});const Tf=Xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Cf=Xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Pf=Xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Uf=Xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Rf=Object.freeze({__proto__:null,base64:Tf,base64pad:Cf,base64url:Pf,base64urlpad:Uf});const Ha=Array.from(""),Ff=Ha.reduce((t,e,r)=>(t[r]=e,t),[]),Lf=Ha.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Mf(t){return t.reduce((e,r)=>(e+=Ff[r],e),"")}function $f(t){const e=[];for(const r of t){const i=Lf[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const jf=si({prefix:"",name:"base256emoji",encode:Mf,decode:$f});var Hf=Object.freeze({__proto__:null,base256emoji:jf}),zf=za,En=128,qf=127,Bf=~qf,Kf=Math.pow(2,31);function za(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Kf;)e[r++]=t&255|En,t/=128;for(;t&Bf;)e[r++]=t&255|En,t>>>=7;return e[r]=t|0,za.bytes=r-i+1,e}var Vf=Hi,Gf=128,wn=127;function Hi(t,i){var r=0,i=i||0,s=0,c=i,p,h=t.length;do{if(c>=h)throw Hi.bytes=0,new RangeError("Could not decode varint");p=t[c++],r+=s<28?(p&wn)<<s:(p&wn)*Math.pow(2,s),s+=7}while(p>=Gf);return Hi.bytes=c-i,r}var kf=Math.pow(2,7),Wf=Math.pow(2,14),Yf=Math.pow(2,21),Jf=Math.pow(2,28),Xf=Math.pow(2,35),Zf=Math.pow(2,42),Qf=Math.pow(2,49),ed=Math.pow(2,56),td=Math.pow(2,63),rd=function(t){return t<kf?1:t<Wf?2:t<Yf?3:t<Jf?4:t<Xf?5:t<Zf?6:t<Qf?7:t<ed?8:t<td?9:10},id={encode:zf,decode:Vf,encodingLength:rd},qa=id;const vn=(t,e,r=0)=>(qa.encode(t,e,r),e),Dn=t=>qa.encodingLength(t),zi=(t,e)=>{const r=e.byteLength,i=Dn(t),s=i+Dn(r),c=new Uint8Array(s+r);return vn(t,c,0),vn(r,c,i),c.set(e,s),new sd(t,r,e,c)};class sd{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Ba=({name:t,code:e,encode:r})=>new nd(t,e,r);class nd{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?zi(this.code,r):r.then(i=>zi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ka=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),ad=Ba({name:"sha2-256",code:18,encode:Ka("SHA-256")}),od=Ba({name:"sha2-512",code:19,encode:Ka("SHA-512")});var cd=Object.freeze({__proto__:null,sha256:ad,sha512:od});const Va=0,hd="identity",Ga=$a,ud=t=>zi(Va,Ga(t)),ld={code:Va,name:hd,encode:Ga,digest:ud};var fd=Object.freeze({__proto__:null,identity:ld});new TextEncoder,new TextDecoder;const Sn={...sf,...af,...cf,...uf,...df,...Df,...xf,...Nf,...Rf,...Hf};({...cd,...fd});function dd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function ka(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const In=ka("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Di=ka("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=dd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),gd={utf8:In,"utf-8":In,hex:Sn.base16,latin1:Di,ascii:Di,binary:Di,...Sn};function pd(t,e="utf8"){const r=gd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const Wa="wc",yd=2,hs="core",Rt=`${Wa}@${2}:${hs}:`,bd={name:hs,logger:"error"},md={database:":memory:"},_d="crypto",xn="client_ed25519_seed",Ed=J.ONE_DAY,wd="keychain",vd="0.3",Dd="messages",Sd="0.3",Id=J.SIX_HOURS,xd="publisher",Ya="irn",Od="error",Ad="wss://relay.walletconnect.com",Nd="relayer",et={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Td="_subscription",Mr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},On=J.ONE_SECOND,Cd="2.3.3",Pd="0.3",wt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Ud="subscription",Rd="0.3",Fd=J.FIVE_SECONDS*1e3,Ld="pairing",Md="0.3",dr={wc_pairingDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:J.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:J.ONE_DAY,prompt:!1,tag:0},res:{ttl:J.ONE_DAY,prompt:!1,tag:0}}},Et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$d="history",jd="0.3",Hd="expirer",ut={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},zd="0.3";let qd=class{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=wd,this.version=vd,this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:c}=Ie("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ua(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ra(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};class Bd{constructor(e,r,i){this.core=e,this.logger=r,this.name=_d,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=en(s);return Ea(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=tl();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),p=en(c),h=Li();return await Iu(h,s,Ed,p)},this.generateSharedKey=(s,c,p)=>{this.isInitialized();const h=this.getPrivateKey(s),f=rl(h,c);return this.setSymKey(f,p)},this.setSymKey=async(s,c)=>{this.isInitialized();const p=c||il(s);return await this.keychain.set(p,s),p},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,p)=>{this.isInitialized();const h=Ca(p),f=qi(c);if(fn(h)){const N=h.senderPublicKey,v=h.receiverPublicKey;s=await this.generateSharedKey(N,v)}const _=this.getSymKey(s),{type:m,senderPublicKey:w}=h;return nl({type:m,symKey:_,message:f,senderPublicKey:w})},this.decode=async(s,c,p)=>{this.isInitialized();const h=cl(c,p);if(fn(h)){const m=h.receiverPublicKey,w=h.senderPublicKey;s=await this.generateSharedKey(m,w)}const f=this.getSymKey(s),_=al({symKey:f,encoded:c});return Xn(_)},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new qd(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const r=cs(e);return xr(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(xn)}catch{e=Li(),await this.keychain.set(xn,e)}return pd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}}let Kd=class extends Fc{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Dd,this.version=Sd,this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const c=Mi(s);let p=this.messages.get(i);return typeof p>"u"&&(p={}),typeof p[c]<"u"||(p[c]=s,this.messages.set(i,p),await this.persist()),c},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const c=this.get(i),p=Mi(s);return typeof c[p]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ua(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ra(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};class Vd extends Lc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new lt.EventEmitter,this.name=xd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}});try{const p=(c==null?void 0:c.ttl)||Id,h=$i(c),f=(c==null?void 0:c.prompt)||!1,_=(c==null?void 0:c.tag)||0,m={topic:i,message:s,opts:{ttl:p,relay:h,prompt:f,tag:_}},w=Mi(s);this.queue.set(w,m);try{await await Fa(this.rpcPublish(i,s,p,h,f,_),this.publishTimeout),this.relayer.events.emit(et.publish,m)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(et.connection_stalled);return}this.onPublish(w,m),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,c,p){var h,f,_,m;const w={method:ji(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:c,tag:p}};return Gr((h=w.params)==null?void 0:h.prompt)&&((f=w.params)==null||delete f.prompt),Gr((_=w.params)==null?void 0:_.tag)&&((m=w.params)==null||delete m.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:w}),this.relayer.provider.request(w)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Gd{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(c=>c!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var kd=Object.defineProperty,Wd=Object.defineProperties,Yd=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,Jd=Object.prototype.hasOwnProperty,Xd=Object.prototype.propertyIsEnumerable,Nn=(t,e,r)=>e in t?kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$r=(t,e)=>{for(var r in e||(e={}))Jd.call(e,r)&&Nn(t,r,e[r]);if(An)for(var r of An(e))Xd.call(e,r)&&Nn(t,r,e[r]);return t},Si=(t,e)=>Wd(t,Yd(e));class Zd extends jc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Gd,this.events=new lt.EventEmitter,this.name=Ud,this.version=Rd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Rt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const c=$i(s),p={topic:i,relay:c};this.pending.set(i,p);const h=await this.rpcSubscribe(i,c);return this.onSubscribe(h,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),h}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,c)=>{const p=new J.Watch;p.start(this.pendingSubscriptionWatchLabel);const h=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(h),p.stop(this.pendingSubscriptionWatchLabel),s(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=Fd&&(clearInterval(h),p.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=$i(i);await this.rpcUnsubscribe(e,r,s);const c=yr("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:ji(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Fa(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(et.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:ji(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,r){this.setSubscription(e,Si($r({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,Si($r({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,$r({},r)),this.topicMap.set(r.topic,e),this.events.emit(wt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=Ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(wt.deleted,Si($r({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(wt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(wt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=Ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,s={topic:r,relay:i};this.pending.set(s.topic,s);const c=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(c,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(et.connect,async()=>{await this.onConnect()}),this.relayer.on(et.disconnect,()=>{this.onDisconnect()}),this.events.on(wt.created,async e=>{const r=wt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(wt.deleted,async e=>{const r=wt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Qd=Object.defineProperty,Tn=Object.getOwnPropertySymbols,eg=Object.prototype.hasOwnProperty,tg=Object.prototype.propertyIsEnumerable,Cn=(t,e,r)=>e in t?Qd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rg=(t,e)=>{for(var r in e||(e={}))eg.call(e,r)&&Cn(t,r,e[r]);if(Tn)for(var r of Tn(e))tg.call(e,r)&&Cn(t,r,e[r]);return t};let ig=class extends Mc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new lt.EventEmitter,this.name=Nd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):wr(Se.getDefaultLoggerOptions({level:e.logger||Od})),this.messages=new Kd(this.logger,e.core),this.subscriber=new Zd(this,this.logger),this.publisher=new Vd(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Ad,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(wt.created,c=>{c.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,r),s()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(et.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(wt.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(et.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(et.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,On)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Er(new Bl(wl({sdkVersion:Cd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Wi(e)){if(!e.method.endsWith(Td))return;const r=e.params,{topic:i,message:s}=r.data,c={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(rg({type:"event",event:r.id},c)),this.events.emit(r.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(et.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Yi(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(Mr.payload,e=>this.onProviderPayload(e)),this.provider.on(Mr.connect,()=>{this.events.emit(et.connect)}),this.provider.on(Mr.disconnect,()=>{this.events.emit(et.disconnect),this.attemptToReconnect()}),this.provider.on(Mr.error,e=>this.events.emit(et.error,e)),this.events.on(et.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},J.toMiliseconds(On))}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var sg=Object.defineProperty,Pn=Object.getOwnPropertySymbols,ng=Object.prototype.hasOwnProperty,ag=Object.prototype.propertyIsEnumerable,Un=(t,e,r)=>e in t?sg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rn=(t,e)=>{for(var r in e||(e={}))ng.call(e,r)&&Un(t,r,e[r]);if(Pn)for(var r of Pn(e))ag.call(e,r)&&Un(t,r,e[r]);return t};class ni extends $c{constructor(e,r,i,s=Rt,c=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Pd,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{$l(p)?this.map.set(p.id,p):jl(p)?this.map.set(p.topic,p):this.getKey&&p!==null&&!Gr(p)&&this.map.set(this.getKey(p),p)}),this.cached=[],this.initialized=!0)},this.set=async(p,h)=>{this.isInitialized(),this.map.has(p)?await this.update(p,h):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:h}),this.map.set(p,h),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(h=>Object.keys(p).every(f=>kr(h[f],p[f]))):this.values),this.update=async(p,h)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:h});const f=Rn(Rn({},this.getData(p)),h);this.map.set(p,f),await this.persist()},this.delete=async(p,h)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:h}),this.map.delete(p),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=Ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=Ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}}class og{constructor(e,r){this.core=e,this.logger=r,this.name=Ld,this.version=Md,this.events=new lt,this.initialized=!1,this.storagePrefix=Rt,this.ignoredPayloadTypes=[ir],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Li(),s=await this.core.crypto.setSymKey(i),c=Ei(J.FIVE_MINUTES),p={protocol:Ya},h={topic:s,expiry:c,relay:p,active:!1},f=Rl({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:p});return await this.pairings.set(s,h),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:f}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:c,relay:p}=Pl(i.uri),h=Ei(J.FIVE_MINUTES),f={topic:s,relay:p,expiry:h,active:!1};return await this.pairings.set(s,f),await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:p}),this.core.expirer.set(s,h),i.activatePairing&&await this.activate({topic:s}),f},this.activate=async({topic:i})=>{this.isInitialized();const s=Ei(J.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:p,resolve:h,reject:f}=vl();this.events.once(wi("pairing_ping",c),({error:_})=>{_?f(_):h()}),await p()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",yr("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,c)=>{const p=Ji(s,c),h=await this.core.crypto.encode(i,p),f=dr[s].req;return this.core.history.set(i,p),await this.core.relayer.publish(i,h,f),p.id},this.sendResult=async(i,s,c)=>{const p=Yi(i,c),h=await this.core.crypto.encode(s,p),f=await this.core.history.get(s,i),_=dr[f.request.method].res;await this.core.relayer.publish(s,h,_),await this.core.history.resolve(p)},this.sendError=async(i,s,c)=>{const p=ki(i,c),h=await this.core.crypto.encode(s,p),f=await this.core.history.get(s,i),_=dr[f.request.method]?dr[f.request.method].res:dr.unregistered_method.res;await this.core.relayer.publish(s,h,_),await this.core.history.resolve(p)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,yr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>yn(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:c}=i,p=c.method;if(this.pairings.keys.includes(s))switch(p){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:c}=i,p=(await this.core.history.get(s,c.id)).request.method;if(this.pairings.keys.includes(s))switch(p){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(i,s)=>{const{id:c}=s;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onPairingPingResponse=(i,s)=>{const{id:c}=s;setTimeout(()=>{Pt(s)?this.events.emit(wi("pairing_ping",c),{}):xt(s)&&this.events.emit(wi("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(c,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:c,method:p}=s;try{if(this.registeredMethods.includes(p))return;const h=yr("WC_METHOD_UNSUPPORTED",p);await this.sendError(c,i,h),this.logger.error(h)}catch(h){await this.sendError(c,i,h),this.logger.error(h)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(yr("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!vi(i)){const{message:s}=Ie("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!Ml(i.uri)){const{message:s}=Ie("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!vi(i)){const{message:c}=Ie("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!vi(i)){const{message:c}=Ie("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Ma(i,!1)){const{message:s}=Ie("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=Ie("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(yn(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=Ie("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new ni(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(et.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);Wi(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Zn(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(ut.expired,async e=>{const{topic:r}=Il(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class cg extends Rc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new lt.EventEmitter,this.name=$d,this.version=jd,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:c}),this.records.has(s.id))return;const p={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:c};this.records.set(p.id,p),this.events.emit(Et.created,p)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=xt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(Et.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===i){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(Et.deleted,c)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Ji(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=Ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Et.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=Ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Et.created,e=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.updated,e=>{const r=Et.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.deleted,e=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}}class hg extends Hc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new lt.EventEmitter,this.name=Hd,this.version=zd,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const c=this.formatTarget(i),p={target:c,expiry:s};this.expirations.set(c,p),this.checkExpiry(c,p),this.events.emit(ut.created,{target:c,expiration:p})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(ut.deleted,{target:s,expiration:c})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Dl(e);if(typeof e=="number")return Sl(e);const{message:r}=Ie("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ut.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=Ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=Ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;J.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ut.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Dr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ut.created,e=>{const r=ut.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.expired,e=>{const r=ut.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.deleted,e=>{const r=ut.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Ie("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ug=Object.defineProperty,Fn=Object.getOwnPropertySymbols,lg=Object.prototype.hasOwnProperty,fg=Object.prototype.propertyIsEnumerable,Ln=(t,e,r)=>e in t?ug(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mn=(t,e)=>{for(var r in e||(e={}))lg.call(e,r)&&Ln(t,r,e[r]);if(Fn)for(var r of Fn(e))fg.call(e,r)&&Ln(t,r,e[r]);return t};class us extends Uc{constructor(e){super(e),this.protocol=Wa,this.version=yd,this.name=hs,this.events=new lt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:wr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||bd.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new Dr.HeartBeat,this.crypto=new Bd(this,this.logger,e==null?void 0:e.keychain),this.history=new cg(this,this.logger),this.expirer=new hg(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new mc(Mn(Mn({},md),e==null?void 0:e.storageOptions)),this.relayer=new ig({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new og(this,this.logger)}static async init(e){const r=new us(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const dg=us;let gg=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},pg=class{constructor(e){this.client=e}};var ls={};Object.defineProperty(ls,"__esModule",{value:!0});var Ja=ls.getWindowMetadata=void 0;const $n=Bi;function yg(){let t,e;try{t=$n.getDocumentOrThrow(),e=$n.getLocationOrThrow()}catch{return null}function r(){const w=t.getElementsByTagName("link"),N=[];for(let v=0;v<w.length;v++){const D=w[v],U=D.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const x=D.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(x.indexOf("/")===0)R+=x;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");R+=d+"/"+x}N.push(R)}else if(x.indexOf("//")===0){const R=e.protocol+x;N.push(R)}else N.push(x)}}return N}function i(...w){const N=t.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],U=["itemprop","property","name"].map(x=>D.getAttribute(x)).filter(x=>x?w.includes(x):!1);if(U.length&&U){const x=D.getAttribute("content");if(x)return x}}return""}function s(){let w=i("name","og:site_name","og:title","twitter:title");return w||(w=t.title),w}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),h=c(),f=e.origin,_=r();return{description:h,url:f,icons:_,name:p}}Ja=ls.getWindowMetadata=yg;var bg={};(function(t){const e=Vi,r=Gi,i=Ki,s=ns,c=o=>o==null,p=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,l)=>{const y=u.length;return l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[",y,"]"].join("")]:[...u,[m(d,o),"[",m(y,o),"]=",m(l,o)].join("")]};case"bracket":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(l,o)].join("")];case"colon-list-separator":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(l,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(l,y)=>y===void 0||o.skipNull&&y===null||o.skipEmptyString&&y===""?l:(y=y===null?"":y,l.length===0?[[m(u,o),d,m(y,o)].join("")]:[[l,m(y,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(l,o)].join("")]}}function f(o){let d;switch(o.arrayFormat){case"index":return(u,l,y)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){y[u]=l;return}y[u]===void 0&&(y[u]={}),y[u][d[1]]=l};case"bracket":return(u,l,y)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"colon-list-separator":return(u,l,y)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"comma":case"separator":return(u,l,y)=>{const n=typeof l=="string"&&l.includes(o.arrayFormatSeparator),g=typeof l=="string"&&!n&&w(l,o).includes(o.arrayFormatSeparator);l=g?w(l,o):l;const P=n||g?l.split(o.arrayFormatSeparator).map(j=>w(j,o)):l===null?l:w(l,o);y[u]=P};case"bracket-separator":return(u,l,y)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){y[u]=l&&w(l,o);return}const g=l===null?[]:l.split(o.arrayFormatSeparator).map(P=>w(P,o));if(y[u]===void 0){y[u]=g;return}y[u]=[].concat(y[u],g)};default:return(u,l,y)=>{if(y[u]===void 0){y[u]=l;return}y[u]=[].concat(y[u],l)}}}function _(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function w(o,d){return d.decode?r(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function U(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function x(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function R(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const u=f(d),l=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return l;for(const y of o.split("&")){if(y==="")continue;let[n,g]=i(d.decode?y.replace(/\+/g," "):y,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?g:w(g,d),u(w(n,d),g,l)}for(const y of Object.keys(l)){const n=l[y];if(typeof n=="object"&&n!==null)for(const g of Object.keys(n))n[g]=x(n[g],d);else l[y]=x(n,d)}return d.sort===!1?l:(d.sort===!0?Object.keys(l).sort():Object.keys(l).sort(d.sort)).reduce((y,n)=>{const g=l[n];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?y[n]=N(g):y[n]=g,y},Object.create(null))}t.extract=U,t.parse=R,t.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const u=g=>d.skipNull&&c(o[g])||d.skipEmptyString&&o[g]==="",l=h(d),y={};for(const g of Object.keys(o))u(g)||(y[g]=o[g]);const n=Object.keys(y);return d.sort!==!1&&n.sort(d.sort),n.map(g=>{const P=o[g];return P===void 0?"":P===null?m(g,d):Array.isArray(P)?P.length===0&&d.arrayFormat==="bracket-separator"?m(g,d)+"[]":P.reduce(l(g),[]).join("&"):m(g,d)+"="+m(P,d)}).filter(g=>g.length>0).join("&")},t.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,l]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:R(U(o),d)},d&&d.parseFragmentIdentifier&&l?{fragmentIdentifier:w(l,d)}:{})},t.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[p]:!0},d);const u=v(o.url).split("?")[0]||"",l=t.extract(o.url),y=t.parse(l,{sort:!1}),n=Object.assign(y,o.query);let g=t.stringify(n,d);g&&(g=`?${g}`);let P=D(o.url);return o.fragmentIdentifier&&(P=`#${d[p]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${g}${P}`},t.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[p]:!1},u);const{url:l,query:y,fragmentIdentifier:n}=t.parseUrl(o,u);return t.stringifyUrl({url:l,query:s(y,d),fragmentIdentifier:n},u)},t.exclude=(o,d,u)=>{const l=Array.isArray(d)?y=>!d.includes(y):(y,n)=>!d(y,n);return t.pick(o,l,u)}})(bg);const mg=1;function _g(){return Ja()||{name:"",description:"",url:"",icons:[""]}}function Ut(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Vt(t,e){return J.fromMiliseconds((e||Date.now())+J.toMiliseconds(t))}function Qt(t){return J.fromMiliseconds(Date.now())>=J.toMiliseconds(t)}function er(t){const e=J.toMiliseconds(t||J.FIVE_MINUTES);let r,i,s;return{resolve:c=>{s&&r&&(clearTimeout(s),r(c))},reject:c=>{s&&i&&(clearTimeout(s),i(c))},done:()=>new Promise((c,p)=>{s=setTimeout(p,e),r=c,i=p})}}function Eg(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function We(t,e){return`${t}${e?`:${e}`:""}`}function Ar(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function wg(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Ar(r.accounts))}),e}function vg(t,e){const r=[];return Object.values(t).forEach(i=>{Ar(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Dg(t,e){const r=[];return Object.values(t).forEach(i=>{Ar(i.accounts).includes(e)&&r.push(...i.events)}),r}function Sg(t,e){const r=Hr(t,e);if(r)throw new Error(r.message);const i={};for(const[s,c]of Object.entries(t))i[s]={methods:c.methods,events:c.events,chains:c.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return i}const Ig={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},xg={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Q(t,e){const{message:r,code:i}=xg[t];return{message:e?`${r} ${e}`:r,code:i}}function at(t,e){const{message:r,code:i}=Ig[t];return{message:e?`${r} ${e}`:r,code:i}}function ai(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Wr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ot(t){return typeof t>"u"}function rt(t,e){return e&&Ot(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function fs(t,e){return e&&Ot(t)?!0:typeof t=="number"&&!isNaN(t)}function Og(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let c=!0;return Ut(s,i)?(i.forEach(p=>{const{accounts:h,methods:f,events:_}=t.namespaces[p],m=Ar(h),w=r[p];(!Ut(w.chains,m)||!Ut(w.methods,f)||!Ut(w.events,_))&&(c=!1)}),c):!1}function ds(t){return rt(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Ag(t){if(rt(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&ds(r)}}return!1}function Ng(t,e){let r=null;return rt(t==null?void 0:t.publicKey,!1)||(r=Q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function jn(t){let e=!0;return ai(t)?t.length&&(e=t.every(r=>rt(r,!1))):e=!1,e}function Tg(t,e,r){let i=null;return ai(e)?e.forEach(s=>{i||(!ds(s)||!s.includes(t))&&(i=at("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=at("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Cg(t,e){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const c=Tg(i,s==null?void 0:s.chains,`${e} requiredNamespace`);c&&(r=c)}),r}function Pg(t,e){let r=null;return ai(t)?t.forEach(i=>{r||Ag(i)||(r=at("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=at("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Ug(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Pg(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function Rg(t,e){let r=null;return jn(t==null?void 0:t.methods)?jn(t==null?void 0:t.events)||(r=at("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=at("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Xa(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Rg(i,`${e}, namespace`);s&&(r=s)}),r}function Fg(t,e){let r=null;if(t&&Wr(t)){const i=Xa(t,e);i&&(r=i);const s=Cg(t,e);s&&(r=s)}else r=Q("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function Hr(t,e){let r=null;if(t&&Wr(t)){const i=Xa(t,e);i&&(r=i);const s=Ug(t,e);s&&(r=s)}else r=Q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Za(t){return rt(t.protocol,!0)}function Lg(t,e){let r=!1;return e&&!t?r=!0:t&&ai(t)&&t.length&&t.forEach(i=>{r=Za(i)}),r}function Mg(t){return typeof t=="number"}function gt(t){return typeof t<"u"&&typeof t!==null}function $g(t){return!(!t||typeof t!="object"||!t.code||!fs(t.code,!1)||!t.message||!rt(t.message,!1))}function jg(t){return!(Ot(t)||!rt(t.method,!1))}function Hg(t){return!(Ot(t)||Ot(t.result)&&Ot(t.error)||!fs(t.id,!1)||!rt(t.jsonrpc,!1))}function zg(t){return!(Ot(t)||!rt(t.name,!1))}function Hn(t,e){return!(!ds(e)||!wg(t).includes(e))}function qg(t,e,r){return rt(r,!1)?vg(t,e).includes(r):!1}function Bg(t,e,r){return rt(r,!1)?Dg(t,e).includes(r):!1}function zn(t,e,r){let i=null;const s=Object.keys(t),c=Object.keys(e);return Ut(s,c)?s.forEach(p=>{if(i)return;const h=t[p].chains,f=Ar(e[p].accounts);Ut(h,f)?Ut(t[p].methods,e[p].methods)?Ut(t[p].events,e[p].events)||(i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${p}`)):i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${p}`):i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${p}`)}):i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}function Kg(t,e){return fs(t,!1)&&t<=e.max&&t>=e.min}const Qa="wc",eo=2,to="client",gs=`${Qa}@${eo}:${to}:`,Ii={name:to,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Vg="proposal",Gg="session",jr=J.SEVEN_DAYS,kg="engine",gr={wc_sessionPropose:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1104},res:{ttl:J.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1106},res:{ttl:J.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1112},res:{ttl:J.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1115}}},xi={min:J.FIVE_MINUTES,max:J.SEVEN_DAYS},Wg="request";var Yg=Object.defineProperty,Jg=Object.defineProperties,Xg=Object.getOwnPropertyDescriptors,qn=Object.getOwnPropertySymbols,Zg=Object.prototype.hasOwnProperty,Qg=Object.prototype.propertyIsEnumerable,Bn=(t,e,r)=>e in t?Yg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,It=(t,e)=>{for(var r in e||(e={}))Zg.call(e,r)&&Bn(t,r,e[r]);if(qn)for(var r of qn(e))Qg.call(e,r)&&Bn(t,r,e[r]);return t},Oi=(t,e)=>Jg(t,Xg(e));class ep extends pg{constructor(e){super(e),this.name=kg,this.events=new lt,this.initialized=!1,this.ignoredPayloadTypes=[mg],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(gr)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:s,relays:c}=r;let p=i,h,f=!1;if(p&&(f=this.client.core.pairing.pairings.get(p).active),!p||!f){const{topic:x,uri:R}=await this.client.core.pairing.create();p=x,h=R}const _=await this.client.core.crypto.generateKeyPair(),m={requiredNamespaces:s,relays:c??[{protocol:Ya}],proposer:{publicKey:_,metadata:this.client.metadata}},{reject:w,resolve:N,done:v}=er();if(this.events.once(We("session_connect"),async({error:x,session:R})=>{if(x)w(x);else if(R){R.self.publicKey=_;const o=Oi(It({},R),{requiredNamespaces:R.requiredNamespaces});await this.client.session.set(R.topic,o),await this.setExpiry(R.topic,R.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:R.peer.metadata}),N(o)}}),!p){const{message:x}=Q("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(x)}const D=await this.sendRequest(p,"wc_sessionPropose",m),U=Vt(J.FIVE_MINUTES);return await this.setProposal(D,It({id:D,expiry:U},m)),{uri:h,approval:v}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:s,namespaces:c}=r,p=this.client.proposal.get(i);let{pairingTopic:h,proposer:f,requiredNamespaces:_}=p;Wr(_)||(_=Sg(c,"approve()"),this.client.proposal.set(i,Oi(It({},p),{requiredNamespaces:_})));const m=await this.client.core.crypto.generateKeyPair(),w=f.publicKey,N=await this.client.core.crypto.generateSharedKey(m,w),v={relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:_,controller:{publicKey:m,metadata:this.client.metadata},expiry:Vt(jr)};await this.client.core.relayer.subscribe(N);const D=await this.sendRequest(N,"wc_sessionSettle",v),{done:U,resolve:x,reject:R}=er();this.events.once(We("session_approve",D),({error:d})=>{d?R(d):x(this.client.session.get(N))});const o=Oi(It({},v),{topic:N,acknowledged:!1,self:v.controller,peer:{publicKey:f.publicKey,metadata:f.metadata},controller:m});return await this.client.session.set(N,o),await this.setExpiry(N,Vt(jr)),h&&await this.client.core.pairing.updateMetadata({topic:h,metadata:o.peer.metadata}),h&&i&&(await this.sendResult(i,h,{relay:{protocol:s??"irn"},responderPublicKey:m}),await this.client.proposal.delete(i,at("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h})),{topic:N,acknowledged:U}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:s}=r,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,s),await this.client.proposal.delete(i,at("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:s}=r,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:p,resolve:h,reject:f}=er();return this.events.once(We("session_update",c),({error:_})=>{_?f(_):h()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:p}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:p,reject:h}=er();return this.events.once(We("session_extend",s),({error:f})=>{f?h(f):p()}),await this.setExpiry(i,Vt(jr)),{acknowledged:c}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:s,topic:c,expiry:p}=r,h=await this.sendRequest(c,"wc_sessionRequest",{request:s,chainId:i},p),{done:f,resolve:_,reject:m}=er(p);return this.events.once(We("session_request",h),({error:w,result:N})=>{w?m(w):_(N)}),await f()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:c}=s;Pt(s)?await this.sendResult(c,i,s.result):xt(s)&&await this.sendError(c,i,s.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:p,reject:h}=er();this.events.once(We("session_ping",s),({error:f})=>{f?h(f):p()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:s,chainId:c}=r;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:c})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",at("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Og(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,at("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,at("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=gr.wc_sessionRequest.req.ttl,{id:s,topic:c,params:p}=r;await this.client.pendingRequest.set(s,{id:s,topic:c,params:p}),i&&this.client.core.expirer.set(s,Vt(i))},this.sendRequest=async(r,i,s,c)=>{const p=Ji(i,s),h=await this.client.core.crypto.encode(r,p),f=gr[i].req;return c&&(f.ttl=c),this.client.core.history.set(r,p),this.client.core.relayer.publish(r,h,f),p.id},this.sendResult=async(r,i,s)=>{const c=Yi(r,s),p=await this.client.core.crypto.encode(i,c),h=await this.client.core.history.get(i,r),f=gr[h.request.method].res;this.client.core.relayer.publish(i,p,f),await this.client.core.history.resolve(c)},this.sendError=async(r,i,s)=>{const c=ki(r,s),p=await this.client.core.crypto.encode(i,c),h=await this.client.core.history.get(i,r),f=gr[h.request.method].res;this.client.core.relayer.publish(i,p,f),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{Qt(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Qt(s.expiry)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=r=>{const{topic:i,payload:s}=r,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:s}=r,c=(await this.client.core.history.get(i,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:s,id:c}=i;try{this.isValidConnect(It({},i.params));const p=Vt(J.FIVE_MINUTES),h=It({id:c,pairingTopic:r,expiry:p},s);await this.setProposal(c,h),this.client.events.emit("session_proposal",{id:c,params:h})}catch(p){await this.sendError(c,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,i)=>{const{id:s}=i;if(Pt(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const p=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const h=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const f=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const _=await this.client.core.crypto.generateSharedKey(h,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:_});const m=await this.client.core.relayer.subscribe(_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),await this.client.core.pairing.activate({topic:r})}else xt(i)&&(await this.client.proposal.delete(s,at("USER_DISCONNECTED")),this.events.emit(We("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:p,controller:h,expiry:f,namespaces:_,requiredNamespaces:m}=i.params,w={topic:r,relay:p,expiry:f,namespaces:_,acknowledged:!0,requiredNamespaces:m,controller:h.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:h.publicKey,metadata:h.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(We("session_connect"),{session:w})}catch(p){await this.sendError(s,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,i)=>{const{id:s}=i;Pt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(We("session_approve",s),{})):xt(i)&&(await this.client.session.delete(r,at("USER_DISCONNECTED")),this.events.emit(We("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:s,id:c}=i;try{this.isValidUpdate(It({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult(c,r,!0),this.client.events.emit("session_update",{id:c,topic:r,params:s})}catch(p){await this.sendError(c,r,p),this.client.logger.error(p)}},this.onSessionUpdateResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(We("session_update",s),{}):xt(i)&&this.events.emit(We("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Vt(jr)),await this.sendResult(s,r,!0),this.client.events.emit("session_extend",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(We("session_extend",s),{}):xt(i)&&this.events.emit(We("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.client.events.emit("session_ping",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,i)=>{const{id:s}=i;setTimeout(()=>{Pt(i)?this.events.emit(We("session_ping",s),{}):xt(i)&&this.events.emit(We("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),this.client.core.relayer.once(et.publish,async()=>{await this.deleteSession(r)}),await this.sendResult(s,r,!0),this.client.events.emit("session_delete",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidRequest(It({topic:r},c)),await this.setPendingSessionRequest({id:s,topic:r,params:c}),this.client.events.emit("session_request",{id:s,topic:r,params:c})}catch(p){await this.sendError(s,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(We("session_request",s),{result:i.result}):xt(i)&&this.events.emit(We("session_request",s),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidEmit(It({topic:r},c)),this.client.events.emit("session_event",{id:s,topic:r,params:c})}catch(p){await this.sendError(s,r,p),this.client.logger.error(p)}},this.isValidConnect=async r=>{if(!gt(r)){const{message:h}=Q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:s,relays:c}=r;if(Ot(i)||await this.isValidPairingTopic(i),!Ot(s)&&Wr(s)===0)return;const p=Fg(s,"connect()");if(p)throw new Error(p.message);if(!Lg(c,!0)){const{message:h}=Q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}},this.isValidApprove=async r=>{if(!gt(r))throw new Error(Q("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:c}=r;await this.isValidProposalId(i);const p=this.client.proposal.get(i),h=Hr(s,"approve()");if(h)throw new Error(h.message);const f=zn(p.requiredNamespaces,s,"update()");if(f)throw new Error(f.message);if(!rt(c,!0)){const{message:_}=Q("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(_)}},this.isValidReject=async r=>{if(!gt(r)){const{message:c}=Q("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:i,reason:s}=r;if(await this.isValidProposalId(i),!$g(s)){const{message:c}=Q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!gt(r)){const{message:_}=Q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(_)}const{relay:i,controller:s,namespaces:c,expiry:p}=r;if(!Za(i)){const{message:_}=Q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(_)}const h=Ng(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);const f=Hr(c,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(Qt(p)){const{message:_}=Q("EXPIRED","onSessionSettleRequest()");throw new Error(_)}},this.isValidUpdate=async r=>{if(!gt(r)){const{message:f}=Q("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:i,namespaces:s}=r;await this.isValidSessionTopic(i);const c=this.client.session.get(i),p=Hr(s,"update()");if(p)throw new Error(p.message);const h=zn(c.requiredNamespaces,s,"update()");if(h)throw new Error(h.message)},this.isValidExtend=async r=>{if(!gt(r)){const{message:s}=Q("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!gt(r)){const{message:f}=Q("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:i,request:s,chainId:c,expiry:p}=r;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!Hn(h,c)){const{message:f}=Q("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(f)}if(!jg(s)){const{message:f}=Q("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(f)}if(!qg(h,c,s.method)){const{message:f}=Q("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(f)}if(p&&!Kg(p,xi)){const{message:f}=Q("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${xi.min} and ${xi.max}`);throw new Error(f)}},this.isValidRespond=async r=>{if(!gt(r)){const{message:c}=Q("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:i,response:s}=r;if(await this.isValidSessionTopic(i),!Hg(s)){const{message:c}=Q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!gt(r)){const{message:s}=Q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!gt(r)){const{message:h}=Q("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(h)}const{topic:i,event:s,chainId:c}=r;await this.isValidSessionTopic(i);const{namespaces:p}=this.client.session.get(i);if(!Hn(p,c)){const{message:h}=Q("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(h)}if(!zg(s)){const{message:h}=Q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}if(!Bg(p,c,s.name)){const{message:h}=Q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}},this.isValidDisconnect=async r=>{if(!gt(r)){const{message:s}=Q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=Q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(et.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(r,i);Wi(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Zn(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(ut.expired,async e=>{const{topic:r,id:i}=Eg(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,Q("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!rt(e,!1)){const{message:r}=Q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=Q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Qt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=Q("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!rt(e,!1)){const{message:r}=Q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=Q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Qt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=Q("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(rt(e,!1)){const{message:r}=Q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=Q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Mg(e)){const{message:r}=Q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=Q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Qt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=Q("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class tp extends ni{constructor(e,r){super(e,r,Vg,gs),this.core=e,this.logger=r}}class rp extends ni{constructor(e,r){super(e,r,Gg,gs),this.core=e,this.logger=r}}class ip extends ni{constructor(e,r){super(e,r,Wg,gs),this.core=e,this.logger=r}}class ps extends gg{constructor(e){super(e),this.protocol=Qa,this.version=eo,this.name=Ii.name,this.events=new lt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Ii.name,this.metadata=(e==null?void 0:e.metadata)||_g();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:wr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ii.logger}));this.core=(e==null?void 0:e.core)||new dg(e),this.logger=Se.generateChildLogger(r,this.name),this.session=new rp(this.core,this.logger),this.proposal=new tp(this.core,this.logger),this.pendingRequest=new ip(this.core,this.logger),this.engine=new ep(this)}static async init(e){const r=new ps(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var ys={};Object.defineProperty(ys,"__esModule",{value:!0});ys.getWindowMetadata=void 0;const Kn=Bi;function sp(){let t,e;try{t=Kn.getDocumentOrThrow(),e=Kn.getLocationOrThrow()}catch{return null}function r(){const w=t.getElementsByTagName("link"),N=[];for(let v=0;v<w.length;v++){const D=w[v],U=D.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const x=D.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(x.indexOf("/")===0)R+=x;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");R+=d+"/"+x}N.push(R)}else if(x.indexOf("//")===0){const R=e.protocol+x;N.push(R)}else N.push(x)}}return N}function i(...w){const N=t.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],U=["itemprop","property","name"].map(x=>D.getAttribute(x)).filter(x=>x?w.includes(x):!1);if(U.length&&U){const x=D.getAttribute("content");if(x)return x}}return""}function s(){let w=i("name","og:site_name","og:title","twitter:title");return w||(w=t.title),w}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),h=c(),f=e.origin,_=r();return{description:h,url:f,icons:_,name:p}}ys.getWindowMetadata=sp;var np={};(function(t){const e=Vi,r=Gi,i=Ki,s=ns,c=o=>o==null,p=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,l)=>{const y=u.length;return l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[",y,"]"].join("")]:[...u,[m(d,o),"[",m(y,o),"]=",m(l,o)].join("")]};case"bracket":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(l,o)].join("")];case"colon-list-separator":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(l,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(l,y)=>y===void 0||o.skipNull&&y===null||o.skipEmptyString&&y===""?l:(y=y===null?"":y,l.length===0?[[m(u,o),d,m(y,o)].join("")]:[[l,m(y,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(l,o)].join("")]}}function f(o){let d;switch(o.arrayFormat){case"index":return(u,l,y)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){y[u]=l;return}y[u]===void 0&&(y[u]={}),y[u][d[1]]=l};case"bracket":return(u,l,y)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"colon-list-separator":return(u,l,y)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"comma":case"separator":return(u,l,y)=>{const n=typeof l=="string"&&l.includes(o.arrayFormatSeparator),g=typeof l=="string"&&!n&&w(l,o).includes(o.arrayFormatSeparator);l=g?w(l,o):l;const P=n||g?l.split(o.arrayFormatSeparator).map(j=>w(j,o)):l===null?l:w(l,o);y[u]=P};case"bracket-separator":return(u,l,y)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){y[u]=l&&w(l,o);return}const g=l===null?[]:l.split(o.arrayFormatSeparator).map(P=>w(P,o));if(y[u]===void 0){y[u]=g;return}y[u]=[].concat(y[u],g)};default:return(u,l,y)=>{if(y[u]===void 0){y[u]=l;return}y[u]=[].concat(y[u],l)}}}function _(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function w(o,d){return d.decode?r(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function U(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function x(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function R(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const u=f(d),l=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return l;for(const y of o.split("&")){if(y==="")continue;let[n,g]=i(d.decode?y.replace(/\+/g," "):y,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?g:w(g,d),u(w(n,d),g,l)}for(const y of Object.keys(l)){const n=l[y];if(typeof n=="object"&&n!==null)for(const g of Object.keys(n))n[g]=x(n[g],d);else l[y]=x(n,d)}return d.sort===!1?l:(d.sort===!0?Object.keys(l).sort():Object.keys(l).sort(d.sort)).reduce((y,n)=>{const g=l[n];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?y[n]=N(g):y[n]=g,y},Object.create(null))}t.extract=U,t.parse=R,t.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const u=g=>d.skipNull&&c(o[g])||d.skipEmptyString&&o[g]==="",l=h(d),y={};for(const g of Object.keys(o))u(g)||(y[g]=o[g]);const n=Object.keys(y);return d.sort!==!1&&n.sort(d.sort),n.map(g=>{const P=o[g];return P===void 0?"":P===null?m(g,d):Array.isArray(P)?P.length===0&&d.arrayFormat==="bracket-separator"?m(g,d)+"[]":P.reduce(l(g),[]).join("&"):m(g,d)+"="+m(P,d)}).filter(g=>g.length>0).join("&")},t.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,l]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:R(U(o),d)},d&&d.parseFragmentIdentifier&&l?{fragmentIdentifier:w(l,d)}:{})},t.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[p]:!0},d);const u=v(o.url).split("?")[0]||"",l=t.extract(o.url),y=t.parse(l,{sort:!1}),n=Object.assign(y,o.query);let g=t.stringify(n,d);g&&(g=`?${g}`);let P=D(o.url);return o.fragmentIdentifier&&(P=`#${d[p]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${g}${P}`},t.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[p]:!1},u);const{url:l,query:y,fragmentIdentifier:n}=t.parseUrl(o,u);return t.stringifyUrl({url:l,query:s(y,d),fragmentIdentifier:n},u)},t.exclude=(o,d,u)=>{const l=Array.isArray(d)?y=>!d.includes(y):(y,n)=>!d(y,n);return t.pick(o,l,u)}})(np);const ap={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function op(t,e){const{message:r,code:i}=ap[t];return{message:e?`${r} ${e}`:r,code:i}}function cp(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function hp(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Ft(t,e){let r;return e.rpcMap&&(r=e.rpcMap[up([t])]),r}function up(t){return Number(t[0].split(":")[1])}class lp{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new Er(new Yr(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class fp{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new Er(new Yr(i))}}class dp{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new Er(new Yr(i))}}class gp{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new Er(new Yr(i))}}const Vn="error",pp="wss://relay.walletconnect.com",yp="wc",bp="universal_provider",Gn=`${yp}@${2}:${bp}:`;var mp=Object.defineProperty,_p=Object.defineProperties,Ep=Object.getOwnPropertyDescriptors,kn=Object.getOwnPropertySymbols,wp=Object.prototype.hasOwnProperty,vp=Object.prototype.propertyIsEnumerable,Wn=(t,e,r)=>e in t?mp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yn=(t,e)=>{for(var r in e||(e={}))wp.call(e,r)&&Wn(t,r,e[r]);if(kn)for(var r of kn(e))vp.call(e,r)&&Wn(t,r,e[r]);return t},Dp=(t,e)=>_p(t,Ep(e));class bs{constructor(e){this.events=new lt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:wr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Vn}))}static async init(e){const r=new bs(e);return await r.initialize(),r}async request(e,r){const[i,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Yn({},e),chainId:`${i}:${s}`,topic:this.session.topic})}sendAsync(e,r,i){this.request(e,i).then(s=>r(null,s)).catch(s=>r(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:op("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:r}=e;return this.setNamespaces(r),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,r){try{const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(cp(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Gn}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ps.init({logger:this.providerOpts.logger||Vn,relayUrl:this.providerOpts.relayUrl||pp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new lp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new fp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new dp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new gp({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,r.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:s}=r,c=(i=this.client)==null?void 0:i.session.get(e);this.session=Dp(Yn({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Gn}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);return!r||!i?hp(this.namespaces):[r,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r){const[i,s]=this.validateChain(r);this.getProvider(i).setDefaultChain(s),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const $p=bs;export{$p as UniversalProvider,bs as default};
