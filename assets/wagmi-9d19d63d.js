import{L as h,v as k,J as _,a as d,B as g,c as m,b as v}from"./chunk-55IO54NW-506e045e.js";import{c as y}from"./index-db580711.js";import"./index-554c0bf5.js";let b=null;try{if(b=WebSocket,b==null)throw new Error("inject please")}catch{const t=new h(k);b=function(){t.throwError("WebSockets not supported in this environment",h.errors.UNSUPPORTED_OPERATION,{operation:"new WebSocket()"})}}var w=globalThis&&globalThis.__awaiter||function(u,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function l(c){try{i(r.next(c))}catch(p){s(p)}}function a(c){try{i(r.throw(c))}catch(p){s(p)}}function i(c){c.done?o(c.value):n(c.value).then(l,a)}i((r=r.apply(u,t||[])).next())})};const f=new h(k);let N=1;class P extends _{constructor(t,e){e==="any"&&f.throwError("WebSocketProvider does not support 'any' network yet",h.errors.UNSUPPORTED_OPERATION,{operation:"network:any"}),typeof t=="string"?super(t,e):super("_websocket",e),this._pollingInterval=-1,this._wsReady=!1,typeof t=="string"?d(this,"_websocket",new b(this.connection.url)):d(this,"_websocket",t),d(this,"_requests",{}),d(this,"_subs",{}),d(this,"_subIds",{}),d(this,"_detectNetwork",super.detectNetwork()),this.websocket.onopen=()=>{this._wsReady=!0,Object.keys(this._requests).forEach(n=>{this.websocket.send(this._requests[n].payload)})},this.websocket.onmessage=n=>{const o=n.data,s=JSON.parse(o);if(s.id!=null){const l=String(s.id),a=this._requests[l];if(delete this._requests[l],s.result!==void 0)a.callback(null,s.result),this.emit("debug",{action:"response",request:JSON.parse(a.payload),response:s.result,provider:this});else{let i=null;s.error?(i=new Error(s.error.message||"unknown error"),d(i,"code",s.error.code||null),d(i,"response",o)):i=new Error("unknown error"),a.callback(i,void 0),this.emit("debug",{action:"response",error:i,request:JSON.parse(a.payload),provider:this})}}else if(s.method==="eth_subscription"){const l=this._subs[s.params.subscription];l&&l.processFunc(s.params.result)}else console.warn("this should not happen")};const r=setInterval(()=>{this.emit("poll")},1e3);r.unref&&r.unref()}get websocket(){return this._websocket}detectNetwork(){return this._detectNetwork}get pollingInterval(){return 0}resetEventsBlock(t){f.throwError("cannot reset events block on WebSocketProvider",h.errors.UNSUPPORTED_OPERATION,{operation:"resetEventBlock"})}set pollingInterval(t){f.throwError("cannot set polling interval on WebSocketProvider",h.errors.UNSUPPORTED_OPERATION,{operation:"setPollingInterval"})}poll(){return w(this,void 0,void 0,function*(){return null})}set polling(t){t&&f.throwError("cannot set polling on WebSocketProvider",h.errors.UNSUPPORTED_OPERATION,{operation:"setPolling"})}send(t,e){const r=N++;return new Promise((n,o)=>{function s(a,i){return a?o(a):n(i)}const l=JSON.stringify({method:t,params:e,id:r,jsonrpc:"2.0"});this.emit("debug",{action:"request",request:JSON.parse(l),provider:this}),this._requests[String(r)]={callback:s,payload:l},this._wsReady&&this.websocket.send(l)})}static defaultUrl(){return"ws://localhost:8546"}_subscribe(t,e,r){return w(this,void 0,void 0,function*(){let n=this._subIds[t];n==null&&(n=Promise.all(e).then(s=>this.send("eth_subscribe",s)),this._subIds[t]=n);const o=yield n;this._subs[o]={tag:t,processFunc:r}})}_startEvent(t){switch(t.type){case"block":this._subscribe("block",["newHeads"],e=>{const r=g.from(e.number).toNumber();this._emitted.block=r,this.emit("block",r)});break;case"pending":this._subscribe("pending",["newPendingTransactions"],e=>{this.emit("pending",e)});break;case"filter":this._subscribe(t.tag,["logs",this._getFilter(t.filter)],e=>{e.removed==null&&(e.removed=!1),this.emit(t.filter,this.formatter.filterLog(e))});break;case"tx":{const e=r=>{const n=r.hash;this.getTransactionReceipt(n).then(o=>{o&&this.emit(n,o)})};e(t),this._subscribe("tx",["newHeads"],r=>{this._events.filter(n=>n.type==="tx").forEach(e)});break}case"debug":case"poll":case"willPoll":case"didPoll":case"error":break;default:console.log("unhandled:",t);break}}_stopEvent(t){let e=t.tag;if(t.type==="tx"){if(this._events.filter(n=>n.type==="tx").length)return;e="tx"}else if(this.listenerCount(t.event))return;const r=this._subIds[e];r&&(delete this._subIds[e],r.then(n=>{this._subs[n]&&(delete this._subs[n],this.send("eth_unsubscribe",[n]))}))}destroy(){return w(this,void 0,void 0,function*(){this.websocket.readyState===b.CONNECTING&&(yield new Promise(t=>{this.websocket.onopen=function(){t(!0)},this.websocket.onerror=function(){t(!1)}})),this.websocket.close(1e3)})}}var O=globalThis&&globalThis.__awaiter||function(u,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function l(c){try{i(r.next(c))}catch(p){s(p)}}function a(c){try{i(r.throw(c))}catch(p){s(p)}}function i(c){c.done?o(c.value):n(c.value).then(l,a)}i((r=r.apply(u,t||[])).next())})};const E=new h(k);class S extends _{detectNetwork(){const t=Object.create(null,{detectNetwork:{get:()=>super.detectNetwork}});return O(this,void 0,void 0,function*(){let e=this.network;return e==null&&(e=yield t.detectNetwork.call(this),e||E.throwError("no network detected",h.errors.UNKNOWN_ERROR,{}),this._network==null&&(d(this,"_network",e),this.emit("network",e,null))),e})}}function R({priority:u,rpc:t,stallTimeout:e,static:r=!0,weight:n}){return function(o){const s=t(o);return!s||s.http===""?null:{chain:{...o,rpcUrls:{...o.rpcUrls,default:{http:[s.http]}}},provider:()=>{var i,c;const l=r?S:_,a=new l(s.http,{ensAddress:(c=(i=o.contracts)==null?void 0:i.ensRegistry)==null?void 0:c.address,chainId:o.id,name:o.network});return Object.assign(a,{priority:u,stallTimeout:e,weight:n})},...s.webSocket&&{webSocketProvider:()=>new P(s.webSocket,o.id)}}}}const I=Symbol(),q={priority:-99,install({provide:u}){const{provider:t}=m(Object.values(y),[R({rpc:r=>({http:r.rpcUrls.default.http[0]})})]),e=v({autoConnect:!0,provider:t});u(I,e)}};export{q as wagmi,I as wagmiClient};
