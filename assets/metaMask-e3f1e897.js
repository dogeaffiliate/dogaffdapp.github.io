import{k as f,_ as w,l as C,m as g,n as _,o as v,q as l,U as p,u as A,R as M}from"./chunk-55IO54NW-d88e2023.js";import"./index-1f934f62.js";var c,R=class extends f{constructor({chains:s,options:a}={}){const e={name:"MetaMask",shimDisconnect:!0,shimChainChangedDisconnect:!0,getProvider(){function o(t){if(t!=null&&t.isMetaMask&&!(t.isBraveWallet&&!t._events&&!t._state)&&!t.isApexWallet&&!t.isAvalanche&&!t.isKuCoinWallet&&!t.isPortal&&!t.isTokenPocket&&!t.isTokenary)return t}if(typeof window>"u")return;const n=window.ethereum;return n!=null&&n.providers?n.providers.find(o):o(n)},...a};super({chains:s,options:e}),w(this,"id","metaMask"),C(this,c,void 0),g(this,c,e.UNSTABLE_shimOnConnectSelectAccount)}async connect({chainId:s}={}){var a,e,o,n;try{const t=await this.getProvider();if(!t)throw new _;t.on&&(t.on("accountsChanged",this.onAccountsChanged),t.on("chainChanged",this.onChainChanged),t.on("disconnect",this.onDisconnect)),this.emit("message",{type:"connecting"});let i=null;if(v(this,c)&&((a=this.options)!=null&&a.shimDisconnect)&&!((e=l().storage)!=null&&e.getItem(this.shimDisconnectKey))&&(i=await this.getAccount().catch(()=>null),!!i))try{await t.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}),i=await this.getAccount()}catch(u){if(this.isUserRejectedRequestError(u))throw new p(u)}if(!i){const h=await t.request({method:"eth_requestAccounts"});i=A.getAddress(h[0])}let r=await this.getChainId(),d=this.isChainUnsupported(r);return s&&r!==s&&(r=(await this.switchChain(s)).id,d=this.isChainUnsupported(r)),(o=this.options)!=null&&o.shimDisconnect&&((n=l().storage)==null||n.setItem(this.shimDisconnectKey,!0)),{account:i,chain:{id:r,unsupported:d},provider:t}}catch(t){throw this.isUserRejectedRequestError(t)?new p(t):t.code===-32002?new M(t):t}}};c=new WeakMap;export{R as MetaMaskConnector};
