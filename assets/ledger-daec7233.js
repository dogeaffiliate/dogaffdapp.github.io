import{t as b,_ as d,l as E,u as g,W as v,U as L,y as m,o as w,m as _}from"./chunk-55IO54NW-81c1a9ab.js";import"./index-28f61451.js";function A(e,c,o,r){return new(o||(o=Promise))(function(t,s){function i(a){try{u(r.next(a))}catch(n){s(n)}}function h(a){try{u(r.throw(a))}catch(n){s(n)}}function u(a){var n;a.done?t(a.value):(n=a.value,n instanceof o?n:new o(function(p){p(n)})).then(i,h)}u((r=r.apply(e,c||[])).next())})}function P(e,c){var o,r,t,s,i={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function h(u){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s&&(s=0,n[0]&&(i=0)),i;)try{if(o=1,r&&(t=2&n[0]?r.return:n[0]?r.throw||((t=r.return)&&t.call(r),0):r.next)&&!(t=t.call(r,n[1])).done)return t;switch(r=0,t&&(n=[2&n[0],t.value]),n[0]){case 0:case 1:t=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,r=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(t=i.trys,!((t=t.length>0&&t[t.length-1])||n[0]!==6&&n[0]!==2)){i=0;continue}if(n[0]===3&&(!t||n[1]>t[0]&&n[1]<t[3])){i.label=n[1];break}if(n[0]===6&&i.label<t[1]){i.label=t[1],t=n;break}if(t&&i.label<t[2]){i.label=t[2],i.ops.push(n);break}t[2]&&i.ops.pop(),i.trys.pop();continue}n=c.call(e,i)}catch(p){n=[6,p],r=0}finally{o=t=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([u,a])}}}var y,C,f;function S(){return A(this,void 0,void 0,function(){var e;return P(this,function(c){return e="ledgerConnectKit",[2,new Promise(function(o,r){var t="ledger-ck-script-".concat(e);if(typeof document<"u")if(document.getElementById(t))o(window[e]);else{var s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/@ledgerhq/connect-kit@1",s.id=t,s.addEventListener("load",function(){o(window[e])}),s.addEventListener("error",function(i){r(i.error)}),document.head.appendChild(s)}else r("Connect Kit does not support server side")})]})})}(function(e){e[e.EthereumMainnet=1]="EthereumMainnet"})(y||(y={})),function(e){e.LedgerConnect="LedgerConnect",e.WalletConnect="WalletConnect"}(C||(C={})),function(e){e.Ethereum="Ethereum",e.Solana="Solana"}(f||(f={}));var l,I=class extends b{constructor({chains:e,options:c={enableDebugLogs:!1}}={}){super({chains:e,options:c}),d(this,"id","ledger"),d(this,"name","Ledger"),d(this,"ready",!0),E(this,l,void 0),d(this,"onAccountsChanged",o=>{o.length===0?this.emit("disconnect"):this.emit("change",{account:g.getAddress(o[0])})}),d(this,"onChainChanged",o=>{const r=m(o),t=this.isChainUnsupported(r);this.emit("change",{chain:{id:r,unsupported:t}})}),d(this,"onDisconnect",()=>{this.emit("disconnect")})}async connect(){try{const e=await this.getProvider({create:!0});e.on&&(e.on("accountsChanged",this.onAccountsChanged),e.on("chainChanged",this.onChainChanged),e.on("disconnect",this.onDisconnect)),this.emit("message",{type:"connecting"});const c=await e.request({method:"eth_requestAccounts"}),o=g.getAddress(c[0]),r=await this.getChainId(),t=this.isChainUnsupported(r);return{account:o,chain:{id:r,unsupported:t},provider:new v(e)}}catch(e){throw e.code===4001?new L(e):e.code===-32002?e instanceof Error?e:new Error(String(e)):e}}async disconnect(){const e=await this.getProvider();e!=null&&e.disconnect&&await e.disconnect(),e!=null&&e.removeListener&&(e.removeListener("accountsChanged",this.onAccountsChanged),e.removeListener("chainChanged",this.onChainChanged),e.removeListener("disconnect",this.onDisconnect)),typeof localStorage<"u"&&localStorage.removeItem("walletconnect")}async getAccount(){const c=await(await this.getProvider()).request({method:"eth_accounts"});return g.getAddress(c[0])}async getChainId(){const c=await(await this.getProvider()).request({method:"eth_chainId"});return m(c)}async getProvider({chainId:e,create:c}={create:!1}){var o;if(!w(this,l)||e||c){const r=await S();this.options.enableDebugLogs&&r.enableDebugLogs();const t=this.chains.reduce((s,i)=>({...s,[i.id]:i.rpcUrls.default.http[0]}),{});r.checkSupport({bridge:this.options.bridge,providerType:f.Ethereum,chainId:e||this.options.chainId,rpc:{...t,...(o=this.options)==null?void 0:o.rpc}}),_(this,l,await r.getProvider())}return w(this,l)}async getSigner({chainId:e}={}){const[c,o]=await Promise.all([this.getProvider({chainId:e}),this.getAccount()]);return new v(c,e).getSigner(o)}async isAuthorized(){try{return!!await this.getAccount()}catch{return!1}}};l=new WeakMap;export{I as LedgerConnector};
